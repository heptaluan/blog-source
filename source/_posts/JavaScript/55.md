---
title: JavaScript 中的栈和堆
date: 2019-05-05
categories: JavaScript
tags: JavaScript
toc: true
thumbnail: https://gitee.com/heptaluan/backups/raw/master/cdn/cover/55.jpg
---

首先要先说一下耳熟能详的「堆栈」，要区分数据结构和内存中各自「堆栈」的含义

<!--more-->

数据结构中的堆和栈是两种不同的、数据项按序排列的数据结构，这里主要介绍的是内存中的堆区与栈区

## 内存中的堆区与栈区

在 `C` 语言中，各个区别如下

* 栈区是分配局部变量的空间

* 堆区是地址向上增长的用于分配我们申请的内存空间

* 另外还有静态区是分配静态变量、全局变量空间的

* 只读区是分配常量和程序代码空间的

一个简单的例子

```c
int a = 0;                  // 全局初始化区
char *p1;                   // 全局未初始化区

main() {
  int b;                    // 栈
  char s[] = "abc";         // 栈
  char *p2;                 // 栈
  char *p3 = "123";         // 在常量区，p3 在栈上
  static int c =0；         // 全局（静态）初始化区
  p1 = (char *)malloc(10);  // 堆
  p2 = (char *)malloc(20);  // 堆
}
```

而 `JavaScript` 是高级语言，底层依靠 `C/C++` 来编译实现，其变量划分为基本数据类型和引用数据类型

基本数据类型包括 `Undefined`，`Null`，`Boolean`，`Number`、`String`（`ES6` 当中新增了 `Symbol()` 基本数据类型）

这些类型在内存中分别占有固定大小的空间，他们的值保存在栈空间，通过按值访问、拷贝和比较

引用类型包括 `Object`，`Array`，`Function`，`Error`，`Date`

这些类型大小不固定，栈内存中存放地址指向堆内存中的对象，是按引用访问的（和 `C` 语言的指针类似）

对于引用类型的变量，栈内存中存放的只是该对象的访问地址，在堆内存中为该值分配空间，由于这种值的大小不固定，因此不能把他们保存在栈内存中

但是内存地址大小是固定的，因此可以将堆内存地址保存到栈内存中

这样一来，当查询引用类型的变量的时候，就会先从栈中读取堆内存地址，然后在根据地址取出对应的值

显而易见的是，`JavaScript` 中所有引用类型创建实例的时候，都是显式或者隐式的 `new` 出对应类型的实例，实际上就是对应 `C` 语言的 `malloc` 分配内存函数


## 栈和队列的区别

* 栈的插入和删除操作都是在一端进行的，而队列的操作却是在两端进行的

* 队列先进先出，栈先进后出

栈只允许在表尾一端进行插入和删除，而队列只允许在表尾一端进行插入，在表头一端进行删除

有一个比较好的记忆方式

* 队列相当我们去银行柜台排队，大家依次鱼贯而行，先进去排队的最先出来

* 栈比较像我们在家中洗碗，最后洗好的碗叠在最上面的，而下次拿的时候是最先拿到最后叠上去的碗


## 栈和堆的区别

* 栈区（`stack`） -- 由编译器自动分配释放，存放函数的参数值，局部变量的值等

* 堆区（`heap`） -- 一般由程序员分配释放，若程序员不释放，程序结束时可能由 `OS` 回收

* 堆（数据结构） -- 堆可以被看成是一棵树，如：堆排序

* 栈（数据结构） -- 一种先进后出的数据结构

