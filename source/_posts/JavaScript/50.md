---
title: BOM 和 DOM
date: 2017-11-17
categories: JavaScript
tags: JavaScript
toc: true
thumbnail: https://gitee.com/heptaluan/backups/raw/master/cdn/cover/50.jpg
---

在网上经常会看到 `ECMAScript`、`DOM`、`BOM` 这几个概念，今天我们就来缕一缕它们到底是什么东西

本篇关于 `DOM` 的相关内容只会提及一二，主要是介绍 `BOM` 的相关内容，其他两者的内容会在后续另起篇幅来单独进行说明

<!--more-->

其实简单来说，如下  

* 核心（`ECMAScript`） -- 提供核心语言功能
* 文档对象模型（`document object model`，简称 `DOM`） -- 提供访问和操作网页内容的方法和接口
* 浏览器对象模型（`broser object model`，简称 `BOM`） -- 提供与浏览器交互的方法和接口

`DOM` 和 `BOM` 并不属于 `JavaScript`（`ECMAScript`）语言的一部分，`DOM` 和 `BOM` 是 `JavaScript` 的运行平台（浏览器）提供的，比如在 `Node.js` 当中就没有 `DOM` 和 `BOM`






## DOM

这里主要介绍 `DOM` 特性相关内容，关于节点增删改查等方面的操作可以参考 [JavaScript 中节点（Node）相关属性](http://localhost:4000/2017/06/26/JavaScript/16/)

部分内容截取自 [知乎 - justjavac 的回答](https://www.zhihu.com/question/67501711)

`JavaScript` 类型分为两大类大类，原生类型和对象类型，而 `DOM` 和 `BOM` 都是对象类型

比如 `HTML` 中的段落 `p` 映射为 `JavaScript` 对象是 `HTMLParagraphElement`，顾名思义 `Paragraph` 就是英语段落的意思

我们看看 `HTMLParagraphElement` 的继承关系

```html
HTMLParagraphElement
 - HTMLElement
  - Element
   - Node
    - EventTarget
     - Object
```

所有的 `DOM` 和 `BOM` 没有任何特殊之处，都是一个 `Object` 的子类

```js
// 创建一个 div dom
var div = document.createElement('div')

// 给 div 添加属性
div.foo = 1234

div.sayHello = function (str) {
  console.log('hello ' + str);
}
```

当我们创建了一个 `DOM Object` 后，我们就可以把这个 `DOM Object` 当作一个普通的 `JavaScript` 对象来使用

说他特殊，大概是因为 `DOM` 的属性和方法会被引擎映射到 `HTML` 标签上，有些会，有些不会，有些只能从 `HTML` 到 `DOM` 映射，有些只能从 `DOM` 到 `HTML` 映射

如果但从对象的角度讲，特殊的不是 `DOM` 和 `BOM`，而是另一个值

```js
Object.create(null)
```

所有的 `JavaScript` 对象都是继承自 `Object`，即使我们经常创建的空对象也是 `Object` 的子类，如下

```js
let obj = { }
```

如下图所示

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/54.png)

但是 `Object.create(null)` 却是实实在在的空对象

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/55.png)

在引擎（`V8`）内部，`DOM` 对象映射为 `C++ Object`

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/56.png)

而每个 `HTML` 标签都对应一个 `DOM Object`

我们看如下代码：

```js
var div = document.createElement('div')   // 创建一个 div dom
div.foo = 1234                            // 给 div 添加属性
var p = document.createElement('p')       // 创建一个 p dom
p.appendChild(div)                        // 把 div 添加为 p 的子节点
div = null                                // div 设置为空
console.log(p.firstChild.foo)
```

可能我们会觉得最终输出的是 `null` 或者 `undefined` 亦或是抛出异常，但是这行代码会输出 `1234`

`DOM` 如何与 `JavaScript Object` 关联在一起的规范定义在 [WebIDL Level 1](https://www.w3.org/TR/WebIDL/) 当中，`WEBIDL` 就是 `Web Interface Definition Language` 的缩写

`DOM Object` 在引擎内部是一个 `C++ Object`，当 `JavaScript` 操作这个 `DOM` 时，引擎使用一个 `wrapper object`，也就是 `JavaScript Object`

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/57.png)

`Wrapper Object` 和 `DOM Object` 的关系如下

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/58.png)

其中（`n >= 0`）

* 当 `n == 0` 时，此 `DOM Object` 不能 通过 `JavaScript` 访问
* 当 `n == 1` 时，此 `DOM Object` 只有一个 `JavaScript Object` 可以访问
* 当 `n > 1` 时，此 `DOM Object` 可以通过多个 `JavaScript` 访问

举个例子

```js
div = document.createElement('div')
div.innerHTML = '<p><span>foo</span><br></p>'
div.firstChild
```

上面代码的对应关系图

![](https://gitee.com/heptaluan/backups/raw/master/cdn/js/59.png)
