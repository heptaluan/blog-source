---
title: 输入网址到页面显示经历的过程
date: 2017-11-07
categories: HTTP
tags: HTTP
toc: true
thumbnail: https://raw.githubusercontent.com/heptaluan/blog/master/backups/cdn/cover/01.jpg
---

总的来说大概就三个流程

* 1）`http` 客户端发起请求，创建端口

* 2）`http` 服务器在端口监听客户端的请求

* 3）`http` 服务器向客户端返回状态和内容

<!--more-->


我们下面就来看看，以 `Chrome` 浏览器搜索 `baidu` 为例，当在浏览器内输入一个 `www.baidu.com` 以后，到底发生了什么


## 第 1 步 搜索自身的 DNS 缓存

浏览器会搜索自身的 `DNS` 缓存，看看自身的缓存中有没有 `baidu.com` 这个域名已经缓存的地址，这个缓存的时间大概只有一分钟，有没有失效可以通过 `chrome://net-internals/#dns` 来查看浏览过的网站的 `DNS` 缓存


## 第 2 步 搜索操作系统的 DNS 缓存

如果浏览器没有找到缓存，或者说这个缓存已经失效，则会搜索操作系统自身的 `DNS` 缓存，如果找到，则它会停止搜索，然后解析也会到此结束


## 第 3 步 读取本地的 HOST 文件

如果操作系统的 `DNS` 缓存也没有找到，那么就会去尝试读取本地的 `host` 文件


## 第 4 步 向主控 DNS 服务器发送请求

如果在 `host` 文件内也没有找到对应的配置项，那么浏览器就会发起一个 `DNS` 的系统调用，就会想本地主控 `DNS` 服务器（一般来说是你的宽带运营商提供）发起的一个域名解析请求


## 第 4.1 步 主控 DNS 服务器查找自身缓存

首先会查找自身的缓存，找到对应的条目，如果说也没用过期，那就解析成功了，那么如果没有找到这个条目



## 第 4.2 步 主控 DNS 服务器发起请求拿到 IP 地址

那么运营商的 `DNS` 服务器就会代替我们的浏览器发起一个迭代的 `DNS` 服务请求

大体步骤如下：

----

根域（拿到 `com` 域） 

--> 

`com` 域 `DNS` 服务器（拿到 `baidu.com`） 

--> 

`baidu.com` 的 `DNS` 服务器（域名的注册商提供，万网，新网等） 

-->  

结果发送给运营商的 `DNS` 服务器（就拿到了 `baidu.com` 这个域名对应的 `IP` 地址） 

--> 

结果返回操作系统内核，同时缓存起来（当然，这个缓存可能会失效，有时间长短 ） 

--> 

内核从服务器上拿到这个 `IP` 地址，就把这个结果返回给浏览器 

--> 

最终浏览器拿到了 `www.baidu.com` 对应的 `IP` 地址

----


## 第 5 步 TCP 三次握手建立连接

域名解析完成以后，也就拿到了域名对应的 `IP` 地址，发起经典的 `TCP` 三次握手，浏览器就会以随机端口像服务器的外部程序发起一个 `TCP` 连接请求，这个连接请求通过层层路由设备，到达服务器端以后

进入到网卡，然后进入到内核的 `TCP/IP` 协议栈（还有可能经过防火墙的过滤），最终到了 `web` 服务端，然后就建立起了这个 `TCP/IP` 的连接


## 第 6 步 到这里就可以发送请求了（GET, POST 等） 

`TCP/IP` 连接建立起来以后，浏览器就可以向服务器发送 `http` 请求了，使用了比如说，用 `http` 的 `GET` 方法请求一个根域里的一个域名，协议可以采用 `HTTP 1.0` 的一个协议


## 第 7 步 响应请求 

服务器端接受到了这个请求，根据路径参数，经过后端的一些处理之后，把处理后的一个结果的数据返回给浏览器，如果是百度的页面，就会把完整的 `HTML` 页面代码返回给浏览器


## 第 8 步 加载数据 

浏览器拿到了百度的完整的 `HTML` 页面代码，在解析和渲染这个页面的时候，里面的 `JavaScript`、`CSS`、图片等静态资源，他们同样也是一个个 `http` 请求都需要经过上面的主要的七个步骤


## 第9步 渲染页面 

浏览器根据拿到的资源对页面进行渲染，最终把一个完整的页面呈现给了用户

