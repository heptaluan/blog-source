---
title: 计算机网络知识梳理
date: 2020-08-08
categories: HTTP
tags: HTTP
toc: true
thumbnail: https://gitee.com/heptaluan/backups/raw/master/cdn/cover/08.jpg
---

最近在梳理计算机网络相关知识，在这里大致的整理一下，其他相关内容可以参考 [前端知识体系整理](https://heptaluan.github.io/target/)，本章大致内容有下面这些

<!--more-->

* 网络 `OSI` 七层模型
* `HTTP/HTTPS`
  * 状态码
  * `GET` 和 `POST` 区别
  * 报文头
  * `HTTP 1.0/2.0/3.0`
  * `HTTPS` 加密
* `TCP/IP`
  * 三次握手/四次挥手
  * 滑动窗口（慢启动/拥塞控制）
  * 可靠通信（`TCP` 状态机）
* `UDP`
* `WebSocket`
* 网络安全

下面我们就从最为基础的部分开始一步一步来慢慢梳理


## 网络 OSI 七层模型

整体如下图所示

![](https://gitee.com/heptaluan/backups/raw/master/cdn/http/08-01.png)

模型 | 概述 | 单位
-|-|-
物理层 | 网络连接介质，如网线、光缆，数据在其中以比特为单位传输 | `bit`
数据链路层 | 数据链路层将比特封装成数据帧并传递 | 帧
网络层 | 定义 `IP` 地址，定义路由功能，建立主机到主机的通信 | 数据包
传输层 | 负责将数据进行可靠或者不可靠传递，建立端口到端口的通信 | 数据段
会话层 | 控制应用程序之间会话能力，区分不同的进程 | 
表示层 | 数据格式标识，基本压缩加密功能 | 
应用层 | 各种应用软件 | 





## HTTP/HTTPS

**常见 HTTP 状态码**

* `2xx` 开头（请求成功）
  * `200 OK`，客户端发送给服务器的请求被正常处理并返回
* `3xx` 开头（重定向）
  * `301 Moved Permanently`，永久重定向，请求的网页已永久移动到新位置，服务器返回此响应时，会自动将请求者转到新位置
  * `302 Moved Permanently`，临时重定向，请求的网页已临时移动到新位置，服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求
  * `304 Not Modified`，未修改，自从上次请求后，请求的网页未修改过，服务器返回此响应时，不会返回网页内容
* `4xx` 开头（客户端错误）
  * `400 Bad Request`，错误请求，服务器不理解请求的语法，常见于客户端传参错误
  * `401 Unauthorized`，未授权，表示发送的请求需要有通过 `HTTP` 认证的认证信息，常见于客户端未登录
  * `403 Forbidden`，禁止，服务器拒绝请求，常见于客户端权限不足
  * `404 Not Found`，未找到，服务器找不到对应资源
* `5xx` 开头（服务端错误）
  * `500 Inter Server Error`，服务器内部错误，服务器遇到错误，无法完成请求
  * `501 Not Implemented`，尚未实施，服务器不具备完成请求的功能
  * `502 Bad Gateway`，作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应
  * `503 service unavailable`，服务不可用，服务器目前无法使用（处于超载或停机维护状态）通常是暂时状态


**GET 和 POST 区别**

* `GET` 请求参数放在URL上，`POST` 请求参数放在请求体里
* `GET` 请求参数长度有限制，`POST` 请求参数长度可以非常大
* `POST` 请求相较于 `GET` 请求安全一点点，因为 `GET` 请求的参数在 `URL` 上，且有历史记录
* `GET` 请求能缓存，`POST` 不能

但是上述答案并不完善，其实 `HTTP` 协议并没有要求 `GET/POST` 请求参数必须放在URL上或请求体里，也没有规定 `GET` 请求的长度，目前对 `URL` 的长度限制，是各家浏览器设置的限制，`GET` 和 `POST` 的根本区别在于 `GET` 请求是幂等性的，而 `POST` 请求不是

> 幂等性，指的是对某一资源进行一次或多次请求都具有相同的副作用，例如搜索就是一个幂等的操作，而删除、新增则不是一个幂等操作

由于 `GET` 请求是幂等的，在网络不好的环境中，`GET` 请求可能会重复尝试，造成重复操作数据的风险，因此，`GET` 请求用于无副作用的操作（如搜索），新增/删除等操作适合用 `POST` 


**报文头**

关于这一部分内容可以见 [HTTP 报文头](http://localhost:4000/2019/08/17/HTTP/07/)，整理的比较详细，内容包括

* 请求报文
* 请求报文示例
* 请求行/请求方法/请求地址/协议及版本/请求头/空行（请求）/请求体
* 响应报文
* 状态行/状态码/状态码描述/响应头/空行（响应）/响应体
* `POST` 提交数据方式（`application/x-www-form-urlencoded/multipart/form-data/application/json/text/xml`）



**HTTP 1.0/2.0/3.0**

我们先来看 `1.0` 和 `1.1` 有什么区别

* 长连接，`HTTP/1.1` 支持长连接和请求的流水线，在一个 `TCP` 连接上可以传送多个 `HTTP` 请求，避免了因为多次建立 `TCP` 连接的时间消耗和延时
* 缓存处理，`HTTP/1.1` 引入 `Entity tag/If-Unmodified-Since/If-Match/If-None-Match` 等新的请求头来控制缓存，详见 [浏览器缓存](http://localhost:4000/2020/07/26/Essay/31/)
* 带宽优化及网络连接的使用，`HTTP1.1` 则在请求头引入了 `range` 头域，支持断点续传功能
* `Host` 头处理，在 `HTTP/1.0` 中认为每台服务器都有唯一的 `IP` 地址，但随着虚拟主机技术的发展，多个主机共享一个 `IP` 地址愈发普遍，`HTTP1.1` 的请求消息和响应消息都应支持 `Host` 头域，且请求消息中如果没有 `Host` 头域会 `400` 错误

关于 `2.0`

* 多路复用，即多个请求都通过一个 `TCP` 连接并发地完成
* 服务端推送，服务端能够主动把资源推送给客户端
* 新的二进制格式，`HTTP/2` 采用二进制格式传输数据，相比于 `HTTP/1.1` 的文本格式，二进制格式具有更好的解析性和拓展性
* `header` 压缩，`HTTP/2` 压缩消息头，减少了传输数据的大小

这里我们详细介绍一下多路复用，其实 `HTTP/2` 解决的问题，就是 `HTTP/1.1` 存在的问题

* `TCP` 慢启动，`TCP` 连接建立后，会经历一个先慢后快的发送过程，就像汽车启动一般，如果我们的网页文件（`HTML/JavaScript/CSS` 等）都经过一次慢启动，对性能是不小的损耗，另外慢启动是 `TCP` 为了减少网络拥塞的一种策略，我们是没有办法改变的
* 多条 `TCP` 连接竞争带宽，如果同时建立多条 `TCP` 连接，当带宽不足时就会竞争带宽，影响关键资源的下载
* `HTTP/1.1` 队头阻塞，尽管 `HTTP/1.1` 长链接可以通过一个 `TCP` 连接传输多个请求，但同一时刻只能处理一个请求，当前请求未结束前，其他请求只能处于阻塞状态

为了解决以上几个问题，`HTTP/2` 一个域名只使用一个 `TCP` 连接来传输数据，而且请求直接是并行的、非阻塞的，这就是多路复用，它的实现原理是，`HTTP/2` 引入了一个二进制分帧层，客户端和服务端进行传输时，数据会先经过二进制分帧层处理，转化为一个个带有请求 `ID` 的帧，这些帧在传输完成后根据 `ID` 组合成对应的数据

关于 `3.0`

尽管 `HTTP/2` 解决了很多 `HTTP/1.1` 的问题，但 `HTTP/2` 仍然存在一些缺陷，这些缺陷并不是来自于 `HTTP/2` 协议本身，而是来源于底层的 `TCP` 协议，我们知道 `TCP` 链接是可靠的连接，如果出现了丢包，那么整个连接都要等待重传，`HTTP/1.1` 可以同时使用六个 `TCP` 连接，一个阻塞另外五个还能工作，但 `HTTP/2` 只有一个 `TCP` 连接，阻塞的问题便被放大了，由于 `TCP` 协议已经被广泛使用，我们很难直接修改 `TCP` 协议，基于此，`HTTP/3` 选择了一个折衷的方法，`UDP` 协议，`HTTP/2` 在 `UDP` 的基础上实现多路复用、`TLS` 加密、流量控制、丢包重传等功能


**HTTP 和 HTTPS 有何区别**

* `HTTPS` 使用 `443` 端口，而 `HTTP` 使用 `80`
* `HTTPS` 需要申请证书
* `HTTP` 是超文本传输协议，是明文传输，`HTTPS` 是经过 `SSL` 加密的协议，传输更安全
* `HTTPS` 比 `HTTP` 慢，因为 `HTTPS` 除了 `TCP` 握手的三个包，还要加上 `SSL` 握手的九个包


**HTTPS 是如何进行加密的**

详细内容可以见 [HTTPS 是如何进行加密的](http://localhost:4000/2020/08/09/HTTP/09/)，主要内容包括

* `HTTP`
* 加密
* 多个客户端
* 对称加密秘钥如何传输
* 非对称加密
* 第三方认证
* 为什么要有签名


## TCP/IP

* 待整理