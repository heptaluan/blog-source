<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>Cesium 中的事件与量测工具 - heptaluan&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="本章当中，我们主要来了解一下 Cesium 中的控件重写、事件应用、相机控制、量测工具与调试面板、以及与第三方库的集成">
<meta name="keywords" content="GIS">
<meta property="og:type" content="article">
<meta property="og:title" content="Cesium 中的事件与量测工具">
<meta property="og:url" content="http://yoursite.com/2021/08/08/GIS/10/index.html">
<meta property="og:site_name" content="heptaluan&#39;s blog">
<meta property="og:description" content="本章当中，我们主要来了解一下 Cesium 中的控件重写、事件应用、相机控制、量测工具与调试面板、以及与第三方库的集成">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/10.webp">
<meta property="og:updated_time" content="2021-08-19T07:26:51.900Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cesium 中的事件与量测工具">
<meta name="twitter:description" content="本章当中，我们主要来了解一下 Cesium 中的控件重写、事件应用、相机控制、量测工具与调试面板、以及与第三方库的集成">
<meta name="twitter:image" content="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/10.webp">







<link rel="icon" href="https://gitee.com/heptaluan/backups/raw/master/cdn/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.5.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <!-- fork me on github -->
<a title="Fork me on GitHub" id="forkMe" style="position: fixed;top: 0;right: 0;z-index: 31" href="https://github.com/heptaluan" target="_blank">
    <svg style="color: #fff;fill: #a0a1a7;height: 80px;width: 80px;" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg>
</a>

<nav class="navbar navbar-main">
    <div class="container">
        <!-- <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Cesium 中的事件与量测工具" height="28">
            
            </a>
        </div> -->

        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="https://heptaluan.github.io/demos/">Demos</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fa fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/10.webp" alt="Cesium 中的事件与量测工具">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <div class="level-item has-text-grey">2021-08-08</div>
                <!-- <time class="level-item has-text-grey" datetime="2021-08-07T16:00:00.000Z">2021-08-08</time> -->
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 读完 (大约 7402 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Cesium 中的事件与量测工具
            
        </h1>
        <div class="content">
            <p>本章当中，我们主要来了解一下 <code>Cesium</code> 中的控件重写、事件应用、相机控制、量测工具与调试面板、以及与第三方库的集成</p>
<a id="more"></a>


<h2 id="控件重写"><a href="#控件重写" class="headerlink" title="控件重写"></a>控件重写</h2><p>本小节当中我们主要来了解一下如何在不修改源码的基础上对界面当中的某些控件进行扩展重写，我们先从 <code>homeButton</code> 组件开始看起</p>
<h4 id="homeButton-组件"><a href="#homeButton-组件" class="headerlink" title="homeButton 组件"></a>homeButton 组件</h4><p><code>homeButton</code> 功能在实际的应用场景中很常见而且功能也很实用，该组件的主要功能是返回到系统初始化时的位置，默认是整个球的位置，如下图</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-01.png" alt></p>
<p>但是在实际的业务场景中，一般初始化范围都是某一个城市或园区的位置，如果使用 <code>Cesium</code> 自带的 <code>homeButton</code> 组件，就需要对其进行修改，使我们在点击 <code>homeButton</code> 时，相机不是定位到 <code>Cesium</code> 自带的默认位置，而是定位到我们想要的位置，针对于此我们只需要简单的两步</p>
<ul>
<li>修改相机的默认矩形范围</li>
</ul>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Cesium.Camera.DEFAULT_VIEW_RECTANGLE = Cesium.Rectangle.fromDegrees(</span><br><span class="line">  <span class="hljs-number">110.15</span>,</span><br><span class="line">  <span class="hljs-number">34.54</span>,</span><br><span class="line">  <span class="hljs-number">110.25</span>,</span><br><span class="line">  <span class="hljs-number">34.56</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <code>homeButton</code> 的 <code>viewModel</code> 中添加监听事件</li>
</ul>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (viewer.homeButton) &#123;</span><br><span class="line">  viewer.homeButton.viewModel.command.beforeExecute.addEventListener(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;</span><br><span class="line">    e.cancel = <span class="hljs-literal">true</span></span><br><span class="line">    <span class="hljs-comment">// 去往的位置</span></span><br><span class="line">    viewer.camera.flyTo(&#123;</span><br><span class="line">      destination: Cesium.Cartesian3.fromDegrees(<span class="hljs-number">117.16</span>, <span class="hljs-number">32.71</span>, <span class="hljs-number">15000.0</span>),</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Geocoder-组件"><a href="#Geocoder-组件" class="headerlink" title="Geocoder 组件"></a>Geocoder 组件</h4><p><code>Geocoder</code> 是地理编码的意思，我们常用的 <code>POI</code> 搜索就是就是 <code>Geocoder</code> 的功劳，通过查看 <a href="https://github.com/CesiumGS/cesium/blob/1.62/Source/Widgets/Geocoder/Geocoder.js#L39" target="_blank" rel="noopener">Geocoder 源码</a>，我们发现 <code>Cesium</code> 默认采用的是 <code>Bing</code> 地图服务来实现地理编码的功能，并且是通过 <code>geocode</code> 方法实现的，那么我们就可以通过覆写 <code>geocoder</code> 方法的方式来实现自定义的地理编码服务</p>
<p>下面我们来尝试重写 <code>geocode</code> 方法，将 <code>Cesium</code> 默认的 <code>Bing</code> 地图服务改为 <code>OSM</code> 地图服务</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OpenStreetMapNominatimGeocoder</span>(<span class="hljs-params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">OpenStreetMapNominatimGeocoder.prototype.geocode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">var</span> url = <span class="hljs-string">'https://nominatim.openstreetmap.org/search'</span></span><br><span class="line">  <span class="hljs-keyword">var</span> resource = <span class="hljs-keyword">new</span> Cesium.Resource(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    queryParameters: &#123;</span><br><span class="line">      format: <span class="hljs-string">'json'</span>,</span><br><span class="line">      q: input,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="hljs-keyword">return</span> resource.fetchJson().then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">results</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">var</span> bboxDegrees</span><br><span class="line">    <span class="hljs-keyword">return</span> results.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resultObject</span>) </span>&#123;</span><br><span class="line">      bboxDegrees = resultObject.boundingbox</span><br><span class="line">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="line">        displayName: resultObject.display_name,</span><br><span class="line">        destination: Cesium.Rectangle.fromDegrees(bboxDegrees[<span class="hljs-number">2</span>], bboxDegrees[<span class="hljs-number">0</span>], bboxDegrees[<span class="hljs-number">3</span>], bboxDegrees[<span class="hljs-number">1</span>]),</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> Cesium.Viewer(<span class="hljs-string">'cesiumContainer'</span>, &#123;</span><br><span class="line">  geocoder: <span class="hljs-keyword">new</span> OpenStreetMapNominatimGeocoder(),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="BaseLayerPicker-组件"><a href="#BaseLayerPicker-组件" class="headerlink" title="BaseLayerPicker 组件"></a>BaseLayerPicker 组件</h4><p><code>Cesium</code> 为我们提供了默认的底图、地形图的选择面板，通过修改 <code>baseLayerPicker</code> 的属性 <code>ture</code> 或 <code>false</code> 来控制显隐，通过选择面板中的底图或地形图来实现对应图层的切换与显示，<code>Cesium</code> 提供的默认选择面板如下图所</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-02.png" alt></p>
<p>这些图层都是在线的资源，如果是离线环境，或者是只显示客户提供的几个图层数据，我们该如何实现呢，要实现这个功能我们首先需要了解一下 <code>BaseLayerPicker</code> 的主要逻辑关系图，如下图</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-03.png" alt></p>
<p>从上图我们可以看出，对于开发者而言，要实现不同的 <code>ImageryProvider</code>，只需要提供不同的 <code>ProviderViewModel</code>，比如 <code>BingMap</code>、<code>OSM</code>、<code>ArcGIS</code>、<code>GoogleMaps</code> 等，这样在 <code>BaseLayerPicker</code> 的 <code>UI</code> 中，就会有多个 <code>Provider</code> 供用户选择，而交互则由 <code>BaseLayerPickerViewModel</code> 类负责，用户并不需要关心内部的实现，<code>BaseLayerPickerViewModel</code> 类已经帮我们都实现了</p>
<p>下面我们就利用 <code>BaseLayerPicker</code> 的逻辑关系，实现自定义的 <code>ImageryProvider</code>（高德矢量图）和 <code>TerrainPovider</code>（<code>ArcGIS</code> 地形），并将其显示在选择器面板中，下面为核心代码</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 自定义影像图层</span></span><br><span class="line"><span class="hljs-keyword">var</span> imageProviderVMs = []</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> gaodeImageProvider = <span class="hljs-keyword">new</span> Cesium.UrlTemplateImageryProvider(&#123;</span><br><span class="line">  url: <span class="hljs-string">'http://webrd0&#123;s&#125;.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;scale=1&amp;style=8&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;z=&#123;z&#125;'</span>,</span><br><span class="line">  subdomains: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>, <span class="hljs-string">'4'</span>],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> gaodeVM = <span class="hljs-keyword">new</span> Cesium.ProviderViewModel(&#123;</span><br><span class="line">  name: <span class="hljs-string">'高德矢量'</span>,</span><br><span class="line">  iconUrl: Cesium.buildModuleUrl(<span class="hljs-string">'Widgets/Images/ImageryProviders/openStreetMap.png'</span>),</span><br><span class="line">  tooltip: <span class="hljs-string">'高德矢量 地图服务'</span>,</span><br><span class="line">  creationFunction: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> gaodeImageProvider</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">imageProviderVMs.push(gaodeVM)</span><br><span class="line"></span><br><span class="line">viewer.baseLayerPicker.viewModel.imageryProviderViewModels = imageProviderVMs</span><br></pre></td></tr></table></figure>

<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 自定义地形图层</span></span><br><span class="line"><span class="hljs-keyword">var</span> terrainProviderVMs = []</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> terrainProvider = <span class="hljs-keyword">new</span> Cesium.ArcGISTiledElevationTerrainProvider(&#123;</span><br><span class="line">  url: <span class="hljs-string">'https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer'</span>,</span><br><span class="line">  token: <span class="hljs-string">'KED1aF_I4UzXOHy3BnhwyBHU4l5oY6rO6walkmHoYqGp4XyIWUd5YZUC1ZrLAzvV40pR6gBXQayh0eFA8m6vPg..'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> arcgisVM = <span class="hljs-keyword">new</span> Cesium.ProviderViewModel(&#123;</span><br><span class="line">  name: <span class="hljs-string">'ArcGIS地形'</span>,</span><br><span class="line">  iconUrl: Cesium.buildModuleUrl(<span class="hljs-string">'Widgets/Images/TerrainProviders/Ellipsoid.png'</span>),</span><br><span class="line">  tooltip: <span class="hljs-string">'ArcGIS地形服务'</span>,</span><br><span class="line">  creationFunction: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> terrainProvider</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">terrainProviderVMs.push(arcgisVM)</span><br><span class="line"></span><br><span class="line">viewer.baseLayerPicker.viewModel.terrainProviderViewModels = terrainProviderVMs</span><br></pre></td></tr></table></figure>

<p>效果是下面这样的</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-04.png" alt></p>
<h2 id="事件应用"><a href="#事件应用" class="headerlink" title="事件应用"></a>事件应用</h2><p>无论是前端系统，还是二维或是三维 <code>GIS</code> 应用系统，都离不开各种事件的应用，尤其是鼠标的单击、双击事件，<code>Cesium</code> 根据事件的类型、用途，将事件应用分成了三大类</p>
<ul>
<li>一种是以鼠标操作（左键、中键、右键操作等）为主的 <code>ScreenSpaceEventHandler</code> 类</li>
<li>另一种是通用的事件类 <code>Event</code>，该类通常在容器类内部实例化，并作为某个属性的类型直接被调用<ul>
<li>比如 <code>viewer.clock.onTick</code>、<code>viewer.selectedEntityChanged</code>、<code>camera.moveStart</code>、<code>camera.moveEnd</code>、<code>scene.preRender</code>、<code>cesium3DTileset.allTilesLoaded</code> 等这些属性都是 <code>Event</code> 类型</li>
</ul>
</li>
<li>最后一种则是相机控制方面的事件类 <code>screenSpaceCameraController</code>，该类通过与 <code>CameraEventType</code> 类配合实现相机的控制</li>
</ul>
<p>下面我们来看几个比较常用的事件应用</p>
<h4 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h4><p>鼠标事件可以说是 <code>GIS</code> 系统里面关于事件应用最常用的一个了，点击地图上的某一个 <code>graphic</code>，并获取其属性信息，就是鼠标事件应用最熟悉的一个场景了，<code>Cesium</code> 为实现这一功能，分成了几个过程</p>
<p>首先传递 <code>viewer.canvas</code> 参数实例化 <code>ScreenSpaceEventHandler</code> 类，比如实例化后的名称为 <code>handler</code>，其次为 <code>handler</code> 注册鼠标事件的监听，最后在监听事件的回调方法中获取 <code>event.position</code>，并将其作为参数执行 <code>scene.pick</code> 方法获取对应的选中对象</p>
<ul>
<li><code>ScreenSpaceEventHandler</code></li>
</ul>
<p>对 <code>ScreenSpaceEventHandler</code> 类进行实例化，注册事件、注销事件代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.canvas)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> eventType = Cesium.ScreenSpaceEventType.LEFT_CLICK</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 注册事件</span></span><br><span class="line">handler.setInputAction(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(event)</span><br><span class="line">&#125;, eventType)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 注销事件</span></span><br><span class="line">handler.removeInputAction(eventType)</span><br></pre></td></tr></table></figure>

<p>上面代码中的事件类型 <code>eventType</code> 直接采用了 <code>ScreenSpaceEventType</code> 中的常量，它的取值有以下这些</p>
<p><strong>鼠标左键</strong></p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>LEFT_CLICK</code></td>
<td>单击</td>
</tr>
<tr>
<td><code>LEFT_DOUBLE__CLICK</code></td>
<td>双击</td>
</tr>
<tr>
<td><code>LEFT_DOWN</code></td>
<td>左键按下</td>
</tr>
<tr>
<td><code>LEFT UP</code></td>
<td>左键弹起</td>
</tr>
</tbody></table>
<p><strong>鼠标中键</strong></p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>MIDDLE_CLICK</code></td>
<td>单击</td>
</tr>
<tr>
<td><code>MIDDLE_DOWN</code></td>
<td>按下</td>
</tr>
<tr>
<td><code>MIDDLE_UP</code></td>
<td>弹起</td>
</tr>
</tbody></table>
<p><strong>鼠标右键</strong></p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>RIGHT_CLICK</code></td>
<td>单击</td>
</tr>
<tr>
<td><code>RIGHT_DOWN</code></td>
<td>按下</td>
</tr>
<tr>
<td><code>RIGHT_UP</code></td>
<td>弹起</td>
</tr>
</tbody></table>
<p><strong>双指触摸</strong></p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>PINCH_START</code></td>
<td>双指开始事件</td>
</tr>
<tr>
<td><code>PINCH_END</code></td>
<td>双指结束事件</td>
</tr>
<tr>
<td><code>PINCH_MOVE</code></td>
<td>双指更改事件</td>
</tr>
</tbody></table>
<p><strong>其他鼠标事件</strong></p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>MOUSE_MOVE</code></td>
<td>鼠标移动事件</td>
</tr>
<tr>
<td><code>WHEEL</code></td>
<td>鼠标滚轮事件</td>
</tr>
</tbody></table>
<ul>
<li>要素拾取</li>
</ul>
<p>假如应用场景是点击要素获取其属性信息，这个时候就需要在鼠标左键的注册事件中获取 <code>event</code> 结果，核心代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> picked = viewer.scene.pick(event.position)</span><br></pre></td></tr></table></figure>

<p>这个时候就可以根据获取到的对象类型进行操作了</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (Cesium.defined(picked)) &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (picked.id &amp;&amp; picked.id <span class="hljs-keyword">instanceof</span> Cesium.Entity) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'选中了 Entity'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (picked.primitive <span class="hljs-keyword">instanceof</span> Cesium.Primitive) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'选中了 Primitive'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (picked.primitive <span class="hljs-keyword">instanceof</span> Cesium.Model) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'选中了模型'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (picked <span class="hljs-keyword">instanceof</span> Cesium.Cesium3DTileFeature) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'选中了 3DTile'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Entity</code> 选择</li>
</ul>
<p><code>Cesium</code> 针对于通过 <code>Entity</code> 方式添加的几何图形，提供了一个非常方便的属性 <code>selectedEntityChanged</code>（<code>viewer</code> 类事件类型的属性）来帮助我们获取选中的 <code>Entity</code>，通过这个属性我们就不需要再注册鼠标事件了，示例代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewer.selectedEntityChanged.addEventListener(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entity</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(entity.id)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在某些场景中，我们可能需要跟踪某一辆车或某一个人员，这时我们可以把车辆或人员 <code>Entity</code> 赋给 <code>viewer.trackedEntity</code>，这样一来相机就会自动跟踪我们所绑定的 <code>Entity</code> 了，实际场景中，我们并不是始终跟踪某一个车辆，有时需要切换到另一个车辆，当切换正在跟踪的车辆时，其实我们是触发了 <code>viewer.trackedEntityChanged</code> 事件，这样我们就可以在此事件中实时获取车辆行驶状态了</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewer.trackedEntityChanged.addEventListener(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entity</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(entity.id)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="相机事件"><a href="#相机事件" class="headerlink" title="相机事件"></a>相机事件</h4><p>相机控制事件类 <code>screenSpaceCameraController</code> 并不是像鼠标事件相关类 <code>ScreenSpaceEventHandler</code> 那样需要提前实例化，<code>Cesium</code> 在 <code>Viewer</code> 类的实例化过程中，也实例化了其他很多类，其中就包括 <code>ScreenSpaceCameraController</code> 类，并把实例化结果赋值给了 <code>viewer.scene.screenSpaceCameraController</code>，所以我们直接去操作 <code>viewer.scene.screenSpaceCameraController</code> 就可以了</p>
<ul>
<li>通过鼠标控制</li>
</ul>
<p>通过鼠标控制相机的方式取决于 <code>CameraEventType</code> 的常量，包括以下几种</p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>LEFT_DRAG</code></td>
<td>按住鼠标左键，然后移动鼠标并释放按钮</td>
</tr>
<tr>
<td><code>MIDDLE_DRAG</code></td>
<td>按住鼠标中键，然后移动鼠标并释放按钮</td>
</tr>
<tr>
<td><code>PINCH</code></td>
<td>触摸表面.上的双指触摸</td>
</tr>
<tr>
<td><code>RIGHT_DRAG</code></td>
<td>按住鼠标右键，然后移动鼠标并释放按钮</td>
</tr>
<tr>
<td><code>WHEEL</code></td>
<td>滚动鼠标中键</td>
</tr>
</tbody></table>
<p>其中，鼠标的默认操作如下</p>
<table>
<thead>
<tr>
<th>鼠标操作</th>
<th>3D</th>
<th>2D</th>
<th>Columbus 视角</th>
</tr>
</thead>
<tbody><tr>
<td>左键 + 拖拽</td>
<td>旋转地球</td>
<td>在地图上移动</td>
<td>在地图上移动</td>
</tr>
<tr>
<td>右键 + 拖拽</td>
<td>缩放</td>
<td>缩放</td>
<td>缩放</td>
</tr>
<tr>
<td>中键滚轮</td>
<td>缩放</td>
<td>缩放</td>
<td>缩放</td>
</tr>
<tr>
<td>中键 + 拖拽</td>
<td>倾斜地球</td>
<td>无操作</td>
<td>倾斜地球</td>
</tr>
</tbody></table>
<p>下面我们来尝试着修改默认的鼠标操作，实现中键缩放、右键旋转，核心代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">viewer.scene.screenSpaceCameraController.tiltEventTypes = [</span><br><span class="line">  Cesium.CameraEventType.RIGHT_DRAG,</span><br><span class="line">  Cesium.CameraEventType.PINCH,</span><br><span class="line">  &#123;</span><br><span class="line">    eventType: Cesium.CameraEventType.LEFT_DRAG,</span><br><span class="line">    modifier: Cesium.KeyboardEventModifier.CTRL,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    eventType: Cesium.CameraEventType.RIGHT_DRAG,</span><br><span class="line">    modifier: Cesium.KeyboardEventModifier.CTRL,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">viewer.scene.screenSpaceCameraController.zoomEventTypes = [</span><br><span class="line">  Cesium.CameraEventType.MIDDLE_DRAG,</span><br><span class="line">  Cesium.CameraEventType.WHEEL,</span><br><span class="line">  Cesium.CameraEventType.PINCH,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>通过键盘控制</li>
</ul>
<p>主要是通过操作键盘实现相机的漫游，比如前进、后退、向上、向下等等，实现键盘漫游主要是通过键盘调用相机的 <code>moveForward</code>、<code>moveBackward</code>、<code>moveLeft</code>、<code>moveRight</code>、<code>moveUp</code>、<code>moveDown</code> 方法，下面为部分核心代码</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">viewer.clock.onTick.addEventListener(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">clock</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">var</span> camera = viewer.camera</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.looking) &#123;</span><br><span class="line">    <span class="hljs-keyword">var</span> width = canvas.clientWidth</span><br><span class="line">    <span class="hljs-keyword">var</span> height = canvas.clientHeight</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Coordinate (0.0, 0.0) will be where the mouse was clicked.</span></span><br><span class="line">    <span class="hljs-keyword">var</span> x = (mousePosition.x - startMousePosition.x) / width</span><br><span class="line">    <span class="hljs-keyword">var</span> y = -(mousePosition.y - startMousePosition.y) / height</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">var</span> lookFactor = <span class="hljs-number">0.05</span></span><br><span class="line">    camera.lookRight(x * lookFactor)</span><br><span class="line">    camera.lookUp(y * lookFactor)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// Change movement speed based on the distance of the camera to the surface of the ellipsoid.</span></span><br><span class="line">  <span class="hljs-keyword">var</span> cameraHeight = ellipsoid.cartesianToCartographic(camera.position).height</span><br><span class="line">  <span class="hljs-keyword">var</span> moveRate = cameraHeight / <span class="hljs-number">100.0</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveForward) &#123;</span><br><span class="line">    camera.moveForward(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveBackward) &#123;</span><br><span class="line">    camera.moveBackward(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveUp) &#123;</span><br><span class="line">    camera.moveUp(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveDown) &#123;</span><br><span class="line">    camera.moveDown(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveLeft) &#123;</span><br><span class="line">    camera.moveLeft(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (flags.moveRight) &#123;</span><br><span class="line">    camera.moveRight(moveRate)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="场景渲染事件"><a href="#场景渲染事件" class="headerlink" title="场景渲染事件"></a>场景渲染事件</h4><p>场景渲染事件主要包括以下四种</p>
<ul>
<li><code>scene.preUpdate</code> - 更新或呈现场景之前将引发的事件</li>
<li><code>scene.postUpdate</code> - 场景更新后以及渲染场景之前立即引发的事件</li>
<li><code>scene.preRender</code> - 场景更新后以及渲染场景之前将引发的事件</li>
<li><code>scene.postRender</code> - 渲染场景后立即引发的事件</li>
</ul>
<p>事件的添加和移除代码示例如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viewer.scene.preUpdate.addEventListender(callbackFunc)</span><br><span class="line">viewer.scene.preUpdate.removeEventListender(callbackFunc)</span><br></pre></td></tr></table></figure>

<p>比如我们自己定义一个指北针、标签，都是可以在 <code>scene.preRender</code> 监听事件的回调函数中更新指北针状态或者是标签的位置信息，下面为部分核心代码</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">viewer.scene.scene.preRender.addEventListener(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (positions <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; htmlSize <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &#123;</span><br><span class="line">    positions.map(<span class="hljs-function">(<span class="hljs-params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="hljs-keyword">const</span> html = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">`infoTip<span class="hljs-subst">$&#123;index&#125;</span>`</span>)</span><br><span class="line">      <span class="hljs-keyword">if</span> (html) &#123;</span><br><span class="line">        <span class="hljs-keyword">const</span> canvasPosition = ConversionUtil.degreesToCartesian2(ele.x, ele.y, ele.z)</span><br><span class="line">        <span class="hljs-keyword">if</span> (canvasPosition) &#123;</span><br><span class="line">          html.style.top = <span class="hljs-string">`<span class="hljs-subst">$&#123;canvasPosition.y - htmlSize[index].offsetHeight&#125;</span>px`</span></span><br><span class="line">          html.style.left = <span class="hljs-string">`<span class="hljs-subst">$&#123;canvasPosition.x - htmlSize[index].offsetWidth&#125;</span>px`</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="相机控制"><a href="#相机控制" class="headerlink" title="相机控制"></a>相机控制</h2><p>相机控制主要是用于相机的飞行定位，例如系统初始化位置定位、视点切换、设备定位、报警事件定位等，这些都是通过对相机进行操作实现的，<code>Cesium</code> 虽然提供了很多种方法用于实现相机的飞行定位，但这些方法都是基于 <code>Viewer</code>、<code>Camera</code> 这两个类实现的</p>
<h4 id="Viewer-类"><a href="#Viewer-类" class="headerlink" title="Viewer 类"></a>Viewer 类</h4><p>在 <code>Viewer</code> 类里面有两个方法用于实现相机的飞行定位，分别是 <code>flyTo</code> 和 <code>zoomTo</code> 方法</p>
<ul>
<li>这两个方法第一个参数都是 <code>target</code>，类型可以是 <code>Entity</code>、<code>DataSource</code>、<code>ImageryLayer</code>、<code>Cesium3DTileset</code> 等</li>
<li><code>flyTo</code> 方法的第二个参数是 <code>options</code>，它是一个包含 <code>duration</code>（飞行持续时间）、<code>maximumHeight</code>（飞行中的最大高度）、<code>offset</code>（<code>HeadingPitchRange</code> 类型）的对象</li>
<li>而 <code>zoomTo</code> 方法的第二个参数是 <code>offset</code>，即上面 <code>options</code> 中的 <code>offset</code>，也是一个 <code>HeadingPitchRange</code> 类型的对象</li>
</ul>
<p><code>Viewer</code> 类中的相机定位方法如下图所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-05.png" alt></p>
<h4 id="Camera类"><a href="#Camera类" class="headerlink" title="Camera类"></a>Camera类</h4><p><code>Camera</code> 类对应的相机定位方法比较多，包括下图当中所示的五个方法，每个方法的参数及参数类型都用不同的颜色区分开来，其中 <code>options</code> 对象参数只列出了主要的属性，更多参数可以查阅官方的 <a href="http://cesium.xin/cesium/cn/Documentation1.62/Camera.html" target="_blank" rel="noopener">API 文档</a> 来了解更多</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-06.png" alt></p>
<p>不管是 <code>Viewer</code> 类还是 <code>Camera</code> 类中的方法都能实现相机的定位功能，根据实际情况选择其一或组合使用，其中 <code>viewer.flyTo()</code>、<code>camera.flyTo()</code>、<code>camera.flyToBoundingSphere()</code> 这三个方法会有一个飞行动画的效果，所以会有飞行持续时间参数 <code>duration</code>，默认是 <code>3</code> 秒</p>
<h4 id="相机参数"><a href="#相机参数" class="headerlink" title="相机参数"></a>相机参数</h4><p>我们不管使用哪种方式，基本上都是先确定相机要飞到的某一个位置，如点、矩形、包围球等，然后再结合相机的三个参数 <code>heading</code>、<code>pitch</code>、<code>roll</code> 或 <code>range</code> 实现某一位置视角的计算，下面主要介绍这三个参数</p>
<p>我们知道 <code>Cesium</code> 使用的是笛卡尔空间直角坐标系，其中 <code>X</code>、<code>Y</code>、<code>Z</code> 三个轴的正方向如下图所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-07.png" alt></p>
<p>相机的三个参数 <code>heading</code>、<code>pitch</code>、<code>roll</code> 的值是针对于坐标轴旋转的弧度数，示意图如下所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-08.png" alt></p>
<ul>
<li><code>heading</code>（偏航角，单位为弧度）</li>
</ul>
<p>绕负 <code>Z</code> 轴旋转，顺时针为正，默认为正北方向 <code>0</code>，其中正角向东增加，控制机体头的朝向位置，即左右方向的改变</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-09.webp" alt></p>
<ul>
<li><code>pitch</code>（俯仰角，单位为弧度）</li>
</ul>
<p>绕负 <code>Y</code> 轴旋转，顺时针为正，默认为俯视 <code>-90</code>，正俯仰角在飞机上方，负俯仰角在飞机下方，可简单理解成前空翻、后空翻</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-10.webp" alt></p>
<ul>
<li><code>roll</code>（翻滚角，单位为弧度）</li>
</ul>
<p>绕正 <code>X</code> 轴旋转，顺时针为正，默认为 <code>0</code>，可简单理解成侧空翻</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-11.webp" alt></p>
<ul>
<li><code>range</code>（翻滚角，单位为米）</li>
</ul>
<p>代表相机距离目标的距离</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>比如针对于某一矩形范围 <code>[110.2, 35.6, 112.3, 36.7]</code>，要求相机倾斜 <code>25</code> 度，实现矩形位置飞行定位的话，有两种方法实现，如下</p>
<ul>
<li>方法一 <code>viewer.flyTo()</code></li>
</ul>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> entity = viewer.entities.add(&#123;</span><br><span class="line">  rectangle: &#123;</span><br><span class="line">    coordinates: rect,</span><br><span class="line">    material: Cesium.Color.GREEN.withAlpha(<span class="hljs-number">1.0</span>),</span><br><span class="line">    height: <span class="hljs-number">10.0</span>,</span><br><span class="line">    outline: <span class="hljs-literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> heading = Cesium.Math.toRadians(<span class="hljs-number">0.0</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> pitch = Cesium.Math.toRadians(<span class="hljs-number">-25.0</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> roll = Cesium.Math.toRadians(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> range = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line">viewer.flyTo(entity, &#123;</span><br><span class="line">  offset: <span class="hljs-keyword">new</span> Cesium.HeadingPitchRange(heading, pitch, range),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>效果是下面这样的</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-12.png" alt></p>
<ul>
<li>方法二 <code>camera.flyTo()</code></li>
</ul>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> rect = Cesium.Rectangle.fromDegrees(<span class="hljs-number">110.2</span>, <span class="hljs-number">35.6</span>, <span class="hljs-number">112.3</span>, <span class="hljs-number">36.7</span>)</span><br><span class="line"></span><br><span class="line">viewer.camera.flyTo(&#123;</span><br><span class="line">  destination: rect,</span><br><span class="line">  orientation: <span class="hljs-keyword">new</span> Cesium.HeadingPitchRoll(heading, pitch, roll),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>效果是下面这样的</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-13.png" alt></p>
<p>但是运行后我们可以发现，第二种方法会显示定位错误，但鼠标稍微往上拖拽一下，也能看到绿色的矩形，那么这是什么原因造成的呢？其实主要问题是出在 <code>pitch</code> 值不是相机的默认值</p>
<p>当相机的 <code>pitch</code> 不是默认值的时候，就会出现相机定位的位置不在屏幕中心的问题，但这时候使用 <code>viewer.flyTo()</code> 方法来实现定位就能解决此问题，所以建议采用方法一实现相机的飞行定位</p>
<h2 id="量测工具"><a href="#量测工具" class="headerlink" title="量测工具"></a>量测工具</h2><p>对于量测工具来说，不管在二维 <code>GIS</code> 还是三维 <code>GIS</code> 中都是必须具备的功能，只不过是在空间上是否有贴地、是否有高度上的距离差别之分，<code>Cesium</code> 是三维 <code>GIS</code> 引擎，所以距离量测支持直线距离、水平距离、垂直距离以及地表距离，面积量测支持水平面积、地表面积以及模型表面积等，不管是哪种类型的距离测量还是面积测量，实现思路基本是一样的，都是按照如下思路实现的</p>
<ol>
<li>点击按钮开始测量，侦听鼠标 <code>LEFT_CLICK</code> 事件，记录坐标，绘制节点和折线（多边形）</li>
<li>侦听鼠标移动事件，鼠标点击后即复制一个浮动点，在 <code>MOUSE_MOVE</code> 事件中不断更新最后一个浮动点，动态更新折线（多边形）绘制</li>
<li>侦听鼠标右击事件，<code>RIGHT_CLICK</code> 触发时销毁测量相关事件句柄（<code>ScreenSpaceEventHandler</code>），删除多余的浮动点</li>
<li>折线（多边形）的动态绘制通过 <code>CallbackProperty</code> 属性绑定 <code>positions</code> 属性实现</li>
</ol>
<p>下面是量测的实现代码</p>
<figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>距离量测<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../Build/Cesium/Cesium.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../Build/Cesium/Widgets/widgets.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><br><span class="line">    html,</span><br><span class="line">    body,</span><br><span class="line"><span class="hljs-css">    <span class="hljs-selector-id">#cesiumContainer</span> &#123;</span></span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      margin: 0;</span><br><span class="line">      padding: 0;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"cesiumContainer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> Cesium.Viewer(<span class="hljs-string">'cesiumContainer'</span>, &#123;</span></span><br><span class="line"><span class="hljs-javascript">      animation: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      baseLayerPicker: <span class="hljs-literal">true</span>,</span></span><br><span class="line"><span class="hljs-javascript">      fullscreenButton: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      vrButton: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      geocoder: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      homeButton: <span class="hljs-literal">true</span>,</span></span><br><span class="line"><span class="hljs-javascript">      infoBox: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      sceneModePicker: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      selectionIndicator: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      timeline: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      navigationHelpButton: <span class="hljs-literal">false</span>,</span></span><br><span class="line"><span class="hljs-javascript">      navigationInstructionsInitiallyVisible: <span class="hljs-literal">false</span>,</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-comment">// 隐藏 logo</span></span></span><br><span class="line"><span class="hljs-javascript">    viewer._cesiumWidget._creditContainer.style.display = <span class="hljs-string">'none'</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene.canvas)</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-comment">// measureAreaSpace(viewer, handler)</span></span></span><br><span class="line">    measureLineSpace(viewer, handler)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-comment">// 测量空间直线距离</span></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">measureLineSpace</span>(<span class="hljs-params">viewer, handler</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 取消双击事件，追踪该位置</span></span></span><br><span class="line">      viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)</span><br><span class="line"><span class="hljs-javascript">      handler = <span class="hljs-keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene._imageryLayerCollection)</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> positions = []</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> poly = <span class="hljs-literal">null</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> distance = <span class="hljs-number">0</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> cartesian = <span class="hljs-literal">null</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> floatingPoint</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">let</span> ray = viewer.camera.getPickRay(movement.endPosition)</span></span><br><span class="line">        cartesian = viewer.scene.globe.pick(ray, viewer.scene)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (positions.length &gt;= <span class="hljs-number">2</span>) &#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">if</span> (!Cesium.defined(poly)) &#123;</span></span><br><span class="line"><span class="hljs-javascript">            poly = <span class="hljs-keyword">new</span> PolyLinePrimitive(positions)</span></span><br><span class="line"><span class="hljs-javascript">          &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="line">            positions.pop()</span><br><span class="line">            positions.push(cartesian)</span><br><span class="line">          &#125;</span><br><span class="line">          distance = getSpaceDistance(positions)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">let</span> ray = viewer.camera.getPickRay(movement.position)</span></span><br><span class="line">        cartesian = viewer.scene.globe.pick(ray, viewer.scene)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (positions.length == <span class="hljs-number">0</span>) &#123;</span></span><br><span class="line">          positions.push(cartesian.clone())</span><br><span class="line">        &#125;</span><br><span class="line">        positions.push(cartesian)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 在三维场景中添加 Label</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> textDisance = distance + <span class="hljs-string">'米'</span></span></span><br><span class="line">        floatingPoint = viewer.entities.add(&#123;</span><br><span class="line"><span class="hljs-javascript">          name: <span class="hljs-string">'空间直线距离'</span>,</span></span><br><span class="line">          position: positions[positions.length - 1],</span><br><span class="line">          point: &#123;</span><br><span class="line">            pixelSize: 5,</span><br><span class="line">            color: Cesium.Color.RED,</span><br><span class="line">            outlineColor: Cesium.Color.WHITE,</span><br><span class="line">            outlineWidth: 2,</span><br><span class="line">          &#125;,</span><br><span class="line">          label: &#123;</span><br><span class="line">            text: textDisance,</span><br><span class="line"><span class="hljs-javascript">            font: <span class="hljs-string">'18px sans-serif'</span>,</span></span><br><span class="line">            fillColor: Cesium.Color.GOLD,</span><br><span class="line">            style: Cesium.LabelStyle.FILL_AND_OUTLINE,</span><br><span class="line">            outlineWidth: 2,</span><br><span class="line">            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,</span><br><span class="line"><span class="hljs-javascript">            pixelOffset: <span class="hljs-keyword">new</span> Cesium.Cartesian2(<span class="hljs-number">20</span>, <span class="hljs-number">-20</span>),</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        handler.destroy() <span class="hljs-comment">// 关闭事件句柄</span></span></span><br><span class="line"><span class="hljs-javascript">        positions.pop()   <span class="hljs-comment">// 最后一个点无效</span></span></span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> PolyLinePrimitive = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_</span>(<span class="hljs-params">positions</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.options = &#123;</span></span><br><span class="line"><span class="hljs-javascript">            name: <span class="hljs-string">'直线'</span>,</span></span><br><span class="line">            polyline: &#123;</span><br><span class="line"><span class="hljs-javascript">              show: <span class="hljs-literal">true</span>,</span></span><br><span class="line">              positions: [],</span><br><span class="line">              material: Cesium.Color.CHARTREUSE,</span><br><span class="line">              width: 10,</span><br><span class="line"><span class="hljs-javascript">              clampToGround: <span class="hljs-literal">true</span>,</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;</span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.positions = positions</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>._init()</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        _.prototype._init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> _self = <span class="hljs-keyword">this</span></span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> _update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">return</span> _self.positions</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-comment">// 实时更新 polyline.positions</span></span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.options.polyline.positions = <span class="hljs-keyword">new</span> Cesium.CallbackProperty(_update, <span class="hljs-literal">false</span>)</span></span><br><span class="line"><span class="hljs-javascript">          viewer.entities.add(<span class="hljs-keyword">this</span>.options)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> _</span></span><br><span class="line">      &#125;)()</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 空间两点距离计算函数</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSpaceDistance</span>(<span class="hljs-params">positions</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> distance = <span class="hljs-number">0</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; positions.length - <span class="hljs-number">1</span>; i++) &#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> point1cartographic = Cesium.Cartographic.fromCartesian(positions[i])</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> point2cartographic = Cesium.Cartographic.fromCartesian(positions[i + <span class="hljs-number">1</span>])</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-comment">// 根据经纬度计算出距离</span></span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> geodesic = <span class="hljs-keyword">new</span> Cesium.EllipsoidGeodesic()</span></span><br><span class="line">          geodesic.setEndPoints(point1cartographic, point2cartographic)</span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> s = geodesic.surfaceDistance</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-comment">// 返回两点之间的距离</span></span></span><br><span class="line"><span class="hljs-javascript">          s = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-built_in">Math</span>.pow(s, <span class="hljs-number">2</span>) + <span class="hljs-built_in">Math</span>.pow(point2cartographic.height - point1cartographic.height, <span class="hljs-number">2</span>))</span></span><br><span class="line">          distance = distance + s</span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> distance.toFixed(<span class="hljs-number">2</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-comment">// 测量空间面积</span></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">measureAreaSpace</span>(<span class="hljs-params">viewer, handler</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 取消双击事件，追踪该位置</span></span></span><br><span class="line">      viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)</span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 鼠标事件</span></span></span><br><span class="line"><span class="hljs-javascript">      handler = <span class="hljs-keyword">new</span> Cesium.ScreenSpaceEventHandler(viewer.scene._imageryLayerCollection)</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> positions = []</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> tempPoints = []</span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> polygon = <span class="hljs-literal">null</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> cartesian = <span class="hljs-literal">null</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> floatingPoint <span class="hljs-comment">// 浮动点</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">let</span> ray = viewer.camera.getPickRay(movement.endPosition)</span></span><br><span class="line">        cartesian = viewer.scene.globe.pick(ray, viewer.scene)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (positions.length &gt;= <span class="hljs-number">2</span>) &#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">if</span> (!Cesium.defined(polygon)) &#123;</span></span><br><span class="line"><span class="hljs-javascript">            polygon = <span class="hljs-keyword">new</span> PolygonPrimitive(positions)</span></span><br><span class="line"><span class="hljs-javascript">          &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="line">            positions.pop()</span><br><span class="line">            positions.push(cartesian)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">let</span> ray = viewer.camera.getPickRay(movement.position)</span></span><br><span class="line">        cartesian = viewer.scene.globe.pick(ray, viewer.scene)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (positions.length == <span class="hljs-number">0</span>) &#123;</span></span><br><span class="line">          positions.push(cartesian.clone())</span><br><span class="line">        &#125;</span><br><span class="line">        positions.push(cartesian)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 在三维场景中添加点</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> cartographic = Cesium.Cartographic.fromCartesian(positions[positions.length - <span class="hljs-number">1</span>])</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> longitudeString = Cesium.Math.toDegrees(cartographic.longitude)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> latitudeString = Cesium.Math.toDegrees(cartographic.latitude)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> heightString = cartographic.height</span></span><br><span class="line">        tempPoints.push(&#123;</span><br><span class="line">          lon: longitudeString,</span><br><span class="line">          lat: latitudeString,</span><br><span class="line">          hei: heightString,</span><br><span class="line">        &#125;)</span><br><span class="line">        floatingPoint = viewer.entities.add(&#123;</span><br><span class="line"><span class="hljs-javascript">          name: <span class="hljs-string">'多边形面积'</span>,</span></span><br><span class="line">          position: positions[positions.length - 1],</span><br><span class="line">          point: &#123;</span><br><span class="line">            pixelSize: 5,</span><br><span class="line">            color: Cesium.Color.RED,</span><br><span class="line">            outlineColor: Cesium.Color.WHITE,</span><br><span class="line">            outlineWidth: 2,</span><br><span class="line">            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      handler.setInputAction(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">movement</span>) </span>&#123;</span></span><br><span class="line">        handler.destroy()</span><br><span class="line">        positions.pop()</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> textArea = getArea(tempPoints) + <span class="hljs-string">'平方公里'</span></span></span><br><span class="line">        viewer.entities.add(&#123;</span><br><span class="line"><span class="hljs-javascript">          name: <span class="hljs-string">'多边形面积'</span>,</span></span><br><span class="line">          position: positions[positions.length - 1],</span><br><span class="line">          label: &#123;</span><br><span class="line">            text: textArea,</span><br><span class="line"><span class="hljs-javascript">            font: <span class="hljs-string">'18px sans-serif'</span>,</span></span><br><span class="line">            fillColor: Cesium.Color.GOLD,</span><br><span class="line">            style: Cesium.LabelStyle.FILL_AND_OUTLINE,</span><br><span class="line">            outlineWidth: 2,</span><br><span class="line">            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,</span><br><span class="line"><span class="hljs-javascript">            pixelOffset: <span class="hljs-keyword">new</span> Cesium.Cartesian2(<span class="hljs-number">20</span>, <span class="hljs-number">-40</span>),</span></span><br><span class="line">            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK)</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> radiansPerDegree = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180.0</span>  <span class="hljs-comment">// 角度转化为弧度（rad）</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> degreesPerRadian = <span class="hljs-number">180.0</span> / <span class="hljs-built_in">Math</span>.PI  <span class="hljs-comment">// 弧度转化为角度</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 计算多边形面积</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getArea</span>(<span class="hljs-params">points</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> res = <span class="hljs-number">0</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 拆分三角曲面</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; points.length - <span class="hljs-number">2</span>; i++) &#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> j = (i + <span class="hljs-number">1</span>) % points.length</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> k = (i + <span class="hljs-number">2</span>) % points.length</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> totalAngle = Angle(points[i], points[j], points[k])</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> dis_temp1 = distance(positions[i], positions[j])</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> dis_temp2 = distance(positions[j], positions[k])</span></span><br><span class="line"><span class="hljs-javascript">          res += dis_temp1 * dis_temp2 * <span class="hljs-built_in">Math</span>.abs(<span class="hljs-built_in">Math</span>.sin(totalAngle))</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-built_in">console</span>.log(res)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> (res / <span class="hljs-number">1000000.0</span>).toFixed(<span class="hljs-number">4</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 角度</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Angle</span>(<span class="hljs-params">p1, p2, p3</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> bearing21 = Bearing(p2, p1)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> bearing23 = Bearing(p2, p3)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> angle = bearing21 - bearing23</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (angle &lt; <span class="hljs-number">0</span>) &#123;</span></span><br><span class="line">          angle += 360</span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> angle</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-comment">// 方向</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bearing</span>(<span class="hljs-params">from, to</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> lat1 = <span class="hljs-keyword">from</span>.lat * radiansPerDegree</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> lon1 = <span class="hljs-keyword">from</span>.lon * radiansPerDegree</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> lat2 = to.lat * radiansPerDegree</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> lon2 = to.lon * radiansPerDegree</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> angle = -<span class="hljs-built_in">Math</span>.atan2(</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-built_in">Math</span>.sin(lon1 - lon2) * <span class="hljs-built_in">Math</span>.cos(lat2),</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-built_in">Math</span>.cos(lat1) * <span class="hljs-built_in">Math</span>.sin(lat2) - <span class="hljs-built_in">Math</span>.sin(lat1) * <span class="hljs-built_in">Math</span>.cos(lat2) * <span class="hljs-built_in">Math</span>.cos(lon1 - lon2)</span></span><br><span class="line">        )</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">if</span> (angle &lt; <span class="hljs-number">0</span>) &#123;</span></span><br><span class="line"><span class="hljs-javascript">          angle += <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2.0</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        angle = angle * degreesPerRadian</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> angle</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-keyword">var</span> PolygonPrimitive = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_</span>(<span class="hljs-params">positions</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.options = &#123;</span></span><br><span class="line"><span class="hljs-javascript">            name: <span class="hljs-string">'多边形'</span>,</span></span><br><span class="line">            polygon: &#123;</span><br><span class="line">              hierarchy: [],</span><br><span class="line">              material: Cesium.Color.GREEN.withAlpha(0.5),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;</span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.hierarchy = &#123; positions &#125;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>._init()</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        _.prototype._init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> _self = <span class="hljs-keyword">this</span></span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">var</span> _update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">return</span> _self.hierarchy</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-comment">// 实时更新 polygon.hierarchy</span></span></span><br><span class="line"><span class="hljs-javascript">          <span class="hljs-keyword">this</span>.options.polygon.hierarchy = <span class="hljs-keyword">new</span> Cesium.CallbackProperty(_update, <span class="hljs-literal">false</span>)</span></span><br><span class="line"><span class="hljs-javascript">          viewer.entities.add(<span class="hljs-keyword">this</span>.options)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> _</span></span><br><span class="line">      &#125;)()</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">distance</span>(<span class="hljs-params">point1, point2</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> point1cartographic = Cesium.Cartographic.fromCartesian(point1)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> point2cartographic = Cesium.Cartographic.fromCartesian(point2)</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 根据经纬度计算出距离</span></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> geodesic = <span class="hljs-keyword">new</span> Cesium.EllipsoidGeodesic()</span></span><br><span class="line">        geodesic.setEndPoints(point1cartographic, point2cartographic)</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">var</span> s = geodesic.surfaceDistance</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 返回两点之间的距离</span></span></span><br><span class="line"><span class="hljs-javascript">        s = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-built_in">Math</span>.pow(s, <span class="hljs-number">2</span>) + <span class="hljs-built_in">Math</span>.pow(point2cartographic.height - point1cartographic.height, <span class="hljs-number">2</span>))</span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-keyword">return</span> s</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>距离测量效果如下图所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-14.png" alt></p>
<p>面积测量效果如下图所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-15.png" alt></p>
<h2 id="调试面板"><a href="#调试面板" class="headerlink" title="调试面板"></a>调试面板</h2><p><code>Cesium</code> 中比较常用的调试面板是用于了解 <code>Cesium</code> 渲染效果以及性能调优的 <code>CesiumInspector</code> 和用于监视 <code>3D Tiles</code> 数据的监视器 <code>Cesium3DTilesInspector</code></p>
<ul>
<li><code>CesiumInspector</code></li>
</ul>
<p>该控件是针对开发人员来说，虽然不能提供功能的实现，但对于了解渲染效果和性能调优是非常有帮助的，特别是解决一些渲染状态下的问题时非常的有价值，使用该控件非常的简单，只需如下一行代码就能实现该控件的加载</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewer.extend(Cesium.viewerCesiumInspectorMixin)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-16.png" alt></p>
<p>控件里面有很多的功能，包括渲染帧数、<code>Primitive</code> 外包围球、<code>Primitive</code> 参考框架、线框模式等等，这里我们就不详细展开了，详细可以参考官方文档当中的 <a href="http://cesium.xin/cesium/cn/Documentation1.62/CesiumInspector.html" target="_blank" rel="noopener">new Cesium.CesiumInspector(container, scene)</a></p>
<ul>
<li><code>Cesium3DTilesInspector</code></li>
</ul>
<p>面对大场景下的大规模、大体量的 <code>3D Tiles</code> 数据，<code>Cesium</code> 提供了一个监视 <code>3D Tiles</code> 数据的监视器，用于监视、观察 <code>3D Tiles</code> 数据的效果，加载该空间也非常的简单，只需一行代码即可，结果控件展示如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewer.extend(Cesium.viewerCesium3DTilesInspectorMixin)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-17.png" alt></p>
<p>主要包括</p>
<ul>
<li><code>3D Tiles</code> 瓦片是否可拾取</li>
<li>显示颜色、线框、瓦片边界范围框、瓦片内容边界范围框、观察者请求体、点云渲染等</li>
<li>一些动态屏幕误差设置、最大屏幕误差设置、样式修改等</li>
</ul>
<h2 id="与第三方库的集成"><a href="#与第三方库的集成" class="headerlink" title="与第三方库的集成"></a>与第三方库的集成</h2><p>这里我们主要简单的介绍 <code>Cesium</code> 与 <code>Three.js</code>、<code>Echarts</code>、<code>Heatmap</code> 和 <code>Turf</code> 是如何集成使用的，下面我们一个一个来进行了解</p>
<h4 id="集成-Three-js"><a href="#集成-Three-js" class="headerlink" title="集成 Three.js"></a>集成 Three.js</h4><p><code>Three.js</code> 是基于原生 <code>WebGL</code> 封装运行的三维引擎库，在所有 <code>WebGL</code> 引擎中，<code>Three.js</code> 是国内文资料最多、使用最广泛的三维引擎，<code>Three.js</code> 可应用于 <code>Web 3D</code> 的可视化（如产品在线浏览、在线三维可视化等），微信小程序游戏，科教领域，机械领域，<code>WebVR</code>（<code>VR</code> 看房、<code>VR</code> 看车等）以及家装室内设计等方面，是一个比较轻量级的跨浏览器 <code>JavaScript</code> 库 ，适合在浏览器中创建和显示动画 <code>3D</code> 计算机图形</p>
<p>将 <code>Cesium</code> 的行星级渲染和 <code>GIS</code> 功能与 <code>Three.js</code> 广泛而易用的通用 <code>3D API</code> 相结合，为新的 <code>WebGL</code> 体验开启了许多可能性，两者的集成总体思路如下</p>
<ol>
<li>创建两个容器，分别用于显示 <code>Cesium</code> 和 <code>Three.js</code> 的场景</li>
<li>分别初始化两者各自的渲染器</li>
<li>调整两者的渲染频率保持一致</li>
<li>调整两者的相机位置角度保持一致</li>
<li>加入要展示的图形</li>
</ol>
<p>以下展示了部分核心代码</p>
<figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"cesiumContainer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"ThreeContainer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 第一步，Cesium 初始化时，要将它的自动渲染关掉（即 useDefaultRenderLoop 属性调整为 false）</span></span><br><span class="line">cesium.viewer = <span class="hljs-keyword">new</span> Cesium.Viewer(<span class="hljs-string">'cesiumContainer'</span>, &#123;</span><br><span class="line">  <span class="hljs-comment">// 关闭自动渲染</span></span><br><span class="line">  useDefaultRenderLoop: <span class="hljs-literal">false</span>,</span><br><span class="line">  <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 第二步，初始化 Three.js</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initThree</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> fov = <span class="hljs-number">45</span></span><br><span class="line">  <span class="hljs-keyword">let</span> width = <span class="hljs-built_in">window</span>.innerWidth</span><br><span class="line">  <span class="hljs-keyword">let</span> height = <span class="hljs-built_in">window</span>.innerHeight</span><br><span class="line">  <span class="hljs-keyword">let</span> aspect = width / height</span><br><span class="line">  <span class="hljs-keyword">let</span> near = <span class="hljs-number">1</span></span><br><span class="line">  <span class="hljs-keyword">let</span> far = <span class="hljs-number">10</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">1000</span> </span><br><span class="line">  three.scene = <span class="hljs-keyword">new</span> THREE.Scene()</span><br><span class="line">  three.camera = <span class="hljs-keyword">new</span> THREE.PerspectiveCamera(fov, aspect, near, far)</span><br><span class="line">  three.renderer = <span class="hljs-keyword">new</span> THREE.WebGLRenderer(&#123; <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span> &#125;)</span><br><span class="line">  ThreeContainer.appendChild(three.renderer.domElement)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 第三步，调整 Three.js 和 Cesium 的渲染频率</span></span><br><span class="line"><span class="hljs-comment">// 手动开启 Cesium 和 Three.js 的渲染，并放进一个渲染频率里</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loop</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  requestAnimationFrame(loop)</span><br><span class="line">  renderCesium()</span><br><span class="line">  renderThreeObj()</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// 第四步，调整相机一致</span></span><br><span class="line">  <span class="hljs-comment">// 这里使用的 Cesium 的相机为主相机，使 Three.js 的相机与 Cesium 保持一致即可</span></span><br><span class="line">  renderCamera()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 第五步，加入要展示的图形</span></span><br><span class="line"><span class="hljs-comment">// 这里加入一个 Cesium 的图形 polygon，再加入一个 Three.js 的球体，以及一个 12 面体</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init3DObject</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> entity = &#123;</span><br><span class="line">    name: <span class="hljs-string">'Polygon'</span>,</span><br><span class="line">    polygon: &#123;</span><br><span class="line">      hierarchy: Cesium.Cartesian3.fromDegreesArray([</span><br><span class="line">        minWGS84[<span class="hljs-number">0</span>],</span><br><span class="line">        minWGS84[<span class="hljs-number">1</span>],</span><br><span class="line">        maxWGS84[<span class="hljs-number">0</span>],</span><br><span class="line">        minWGS84[<span class="hljs-number">1</span>],</span><br><span class="line">        maxWGS84[<span class="hljs-number">0</span>],</span><br><span class="line">        maxWGS84[<span class="hljs-number">1</span>],</span><br><span class="line">        minWGS84[<span class="hljs-number">0</span>],</span><br><span class="line">        maxWGS84[<span class="hljs-number">1</span>],</span><br><span class="line">      ]),</span><br><span class="line">      material: Cesium.Color.RED.withAlpha(<span class="hljs-number">0.1</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">let</span> Polypon = cesium.viewer.entities.add(entity)</span><br><span class="line">  <span class="hljs-keyword">let</span> doubleSideMaterial = <span class="hljs-keyword">new</span> THREE.MeshNormalMaterial(&#123;</span><br><span class="line">    side: THREE.DoubleSide,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  geometry = <span class="hljs-keyword">new</span> THREE.SphereGeometry(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">let</span> sphere = <span class="hljs-keyword">new</span> THREE.Mesh(</span><br><span class="line">    geometry,</span><br><span class="line">    <span class="hljs-keyword">new</span> THREE.MeshPhongMaterial(&#123;</span><br><span class="line">      color: <span class="hljs-number">0xffffff</span>,</span><br><span class="line">      side: THREE.DoubleSide,</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">  <span class="hljs-comment">//  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果图如下所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-18.png" alt></p>
<h4 id="集成-Echarts"><a href="#集成-Echarts" class="headerlink" title="集成 Echarts"></a>集成 Echarts</h4><p><code>Echarts</code> 是一个基于 <code>JavaScript</code> 的开源可视化图表库，具有丰富的图表类型，可用于地理数据可视化的地图、热力图、线图等，<code>Cesium</code> 通过与 <code>Echarts</code> 的地理数据可视化能力相结合，大大增强 <code>Cesium</code> 整体的可视化效果</p>
<p>我们这里通过封装 <code>EchartsLayer</code> 来实现迁徙图的效果，需要注意的是在图表的 <code>option</code> 配置项中不需要写 <code>geo</code>，同时每个 <code>series</code> 数组中元素都必须加 <code>coordinateSystem: &#39;GLMap&#39;</code>，部分核心代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> EchartsLayer = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">map, options</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">this</span>._map = map</span><br><span class="line">  <span class="hljs-keyword">this</span>._overlay = <span class="hljs-keyword">this</span>._createChartOverlay()</span><br><span class="line">  <span class="hljs-keyword">if</span> (options) &#123;</span><br><span class="line">    <span class="hljs-keyword">this</span>._registerMap()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">this</span>._overlay.setOption(options || &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> _echartLayer = <span class="hljs-keyword">new</span> EchartsLayer(viewer, option)</span><br></pre></td></tr></table></figure>

<p>实现的效果如下所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-19.png" alt></p>
<h4 id="集成-Heatmap"><a href="#集成-Heatmap" class="headerlink" title="集成 Heatmap"></a>集成 Heatmap</h4><p><a href="https://www.patrick-wied.at/static/heatmapjs/" target="_blank" rel="noopener">heatmap.js</a> 是一个轻量级的、最先进的用于表达热力图的可视化前端库，比如人群分布情况、污染物浓度变化情况、信号强度等</p>
<p>两者的集成比较简单，就是把使用 <code>heatmap.js</code> 生成的热力图，以贴图材质的方式赋给某个几何图形贴图属性即可，部分核心代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 根据热力图图片范围，生成随机热力点和强度值</span></span><br><span class="line"><span class="hljs-keyword">var</span> dataRaw = []</span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="hljs-keyword">var</span> point = &#123;</span><br><span class="line">    lat: latMin + <span class="hljs-built_in">Math</span>.random() * (latMax - latMin),</span><br><span class="line">    lon: lonMin + <span class="hljs-built_in">Math</span>.random() * (lonMax - lonMin),</span><br><span class="line">    value: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">100</span>),</span><br><span class="line">  &#125;</span><br><span class="line">  dataRaw.push(point)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 生成数据</span></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="hljs-keyword">var</span> dataItem = dataRaw[i]</span><br><span class="line">  <span class="hljs-keyword">var</span> point = &#123;</span><br><span class="line">    x: <span class="hljs-built_in">Math</span>.floor(((dataItem.lat - latMin) / (latMax - latMin)) * width),</span><br><span class="line">    y: <span class="hljs-built_in">Math</span>.floor(((dataItem.lon - lonMin) / (lonMax - lonMin)) * height),</span><br><span class="line">    value: <span class="hljs-built_in">Math</span>.floor(dataItem.value),</span><br><span class="line">  &#125;</span><br><span class="line">  max = <span class="hljs-built_in">Math</span>.max(max, dataItem.value)</span><br><span class="line">  points.push(point)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 创建热力图</span></span><br><span class="line"><span class="hljs-keyword">var</span> heatmapInstance = h337.create(&#123;</span><br><span class="line">  container: <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.heatmap'</span>),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> data = &#123;</span><br><span class="line">  max: max,</span><br><span class="line">  data: points,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">heatmapInstance.setData(data)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 将热力图添加到球体上（生成的热力图 canvas 元素类名为 heatmap-canvas）</span></span><br><span class="line"><span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'heatmap-canvas'</span>)</span><br><span class="line"></span><br><span class="line">viewer.entities.add(&#123;</span><br><span class="line">  name: <span class="hljs-string">'heatmap'</span>,</span><br><span class="line">  rectangle: &#123;</span><br><span class="line">    coordinates: Cesium.Rectangle.fromDegrees(lonMin, latMin, lonMax, latMax),</span><br><span class="line">    material: <span class="hljs-keyword">new</span> Cesium.ImageMaterialProperty(&#123;</span><br><span class="line">      image: canvas[<span class="hljs-number">0</span>],</span><br><span class="line">      transparent: <span class="hljs-literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>实现的效果如下所示</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-20.png" alt></p>
<h4 id="集成-Turf"><a href="#集成-Turf" class="headerlink" title="集成 Turf"></a>集成 Turf</h4><p><code>Cesium</code> 本身更侧重于三维可视化，在空间分析方面会显得薄弱些，当然空间分析能力可以借助开源 <code>postGIS</code> 中的函数去实现，然后将结果通过 <code>Cesium</code> 去呈现，这里我们不对 <code>postGIS</code> 进行介绍，而是使用一个轻量级的用于空间分析的前端库，即 <code>Turf</code></p>
<p><code>Turf</code> 的定位是地理空间分析库，处理各种地图算法，特点是离线计算、模块化、快速，下面是一个计算两点之间的距离的简单示例</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> point1 = turf.point([<span class="hljs-number">144.834823</span>, <span class="hljs-number">-37.771257</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> point2 = turf.point([<span class="hljs-number">145.14244</span>, <span class="hljs-number">-37.830937</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> midpoint = turf.midpoint(point1, point2)</span><br></pre></td></tr></table></figure>

<p>而下面的截图是通过 <code>Turf</code>、<code>Cesium</code> 实现的点、线、面缓冲区分析结果，即借助了 <code>Turf</code> 的空间分析能力和 <code>Cesium</code> 的可视化能力</p>
<p><img src="https://gitee.com/heptaluan/backups/raw/master/cdn/gis/10-21.png" alt></p>
<p>部分核心代码如下</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 初始化点缓冲</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initPointBuffer</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> point = [<span class="hljs-number">106.422638966289</span>, <span class="hljs-number">29.5698367125623</span>]</span><br><span class="line">  addPoint(point)</span><br><span class="line">  <span class="hljs-keyword">let</span> pointF = turf.point(point)</span><br><span class="line">  <span class="hljs-keyword">let</span> buffered = turf.buffer(pointF, <span class="hljs-number">60</span>, &#123; <span class="hljs-attr">units</span>: <span class="hljs-string">'meters'</span> &#125;)</span><br><span class="line">  <span class="hljs-keyword">let</span> coordinates = buffered.geometry.coordinates</span><br><span class="line">  <span class="hljs-keyword">let</span> points = coordinates[<span class="hljs-number">0</span>]</span><br><span class="line">  <span class="hljs-keyword">let</span> degreesArray = pointsToDegreesArray(points)</span><br><span class="line">  addBufferPolyogn(Cesium.Cartesian3.fromDegreesArray(degreesArray))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 添加点</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addPoint</span>(<span class="hljs-params">point</span>) </span>&#123;</span><br><span class="line">  viewer.entities.add(&#123;</span><br><span class="line">    position: Cesium.Cartesian3.fromDegrees(point[<span class="hljs-number">0</span>], point[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>),</span><br><span class="line">    point: &#123;</span><br><span class="line">      pixelSize: <span class="hljs-number">10</span>,</span><br><span class="line">      heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,</span><br><span class="line">      color: Cesium.Color.YELLOW,</span><br><span class="line">      outlineWidth: <span class="hljs-number">3</span>,</span><br><span class="line">      outlineColor: Cesium.Color.YELLOW.withAlpha(<span class="hljs-number">0.4</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 添加缓冲面</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addBufferPolyogn</span>(<span class="hljs-params">positions</span>) </span>&#123;</span><br><span class="line">  viewer.entities.add(&#123;</span><br><span class="line">    polygon: &#123;</span><br><span class="line">      hierarchy: <span class="hljs-keyword">new</span> Cesium.PolygonHierarchy(positions),</span><br><span class="line">      material: Cesium.Color.RED.withAlpha(<span class="hljs-number">0.6</span>),</span><br><span class="line">      classificationType: Cesium.ClassificationType.BOTH,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果觉得比较麻烦的话，可以直接使用 <a href="https://github.com/MikesWei/CesiumVectorTile" target="_blank" rel="noopener">CesiumVectorTile</a> 这个封装好的库，它支持小数据量的 <code>GeoJSON</code>、<code>Shape</code> 文件矢量动态切片，并且还能实现贴地效果</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/GIS/">GIS</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2021/08/22/GIS/11/">
                <i class="level-item fa fa-chevron-left"></i>
                <span class="level-item">Cesium 中一些常用方法汇总</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2021/08/07/GIS/09/">
                <span class="level-item">glTF 与 3D Tiles</span>
                <i class="level-item fa fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: '584b59de0d23cd48fbdd',
        clientSecret: '5554c9aab0a640015867806f438bd2e10f297e5a',
        id: 'dc5c4913cc669c15822800a5e9d2df79',
        repo: 'gitalk',
        owner: 'heptaluan',
        admin: "heptaluan"
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <figure class="avatar image is-128x128 has-mb-6">
                            <img class="is-rounded" src="https://gitee.com/heptaluan/backups/raw/master/cdn/avatar.png" alt="heptaluan">
                        </figure>
                    
                    
                    <p class="is-size-4 is-block">
                        heptaluan
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Torches@Aimer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>WuHan China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <!-- <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        164
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        9
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        9
                    </p>
                </div>
            </div>
        </nav> -->
        <!-- <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                关注我</a>
        </div> -->
        
        
    </div>
</div>
    
        
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#控件重写">
        <span class="has-mr-6">1</span>
        <span>控件重写</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#homeButton-组件">
        <span class="has-mr-6">1.1</span>
        <span>homeButton 组件</span>
        </a></li><li>
        <a class="is-flex" href="#Geocoder-组件">
        <span class="has-mr-6">1.2</span>
        <span>Geocoder 组件</span>
        </a></li><li>
        <a class="is-flex" href="#BaseLayerPicker-组件">
        <span class="has-mr-6">1.3</span>
        <span>BaseLayerPicker 组件</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#事件应用">
        <span class="has-mr-6">2</span>
        <span>事件应用</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#鼠标事件">
        <span class="has-mr-6">2.1</span>
        <span>鼠标事件</span>
        </a></li><li>
        <a class="is-flex" href="#相机事件">
        <span class="has-mr-6">2.2</span>
        <span>相机事件</span>
        </a></li><li>
        <a class="is-flex" href="#场景渲染事件">
        <span class="has-mr-6">2.3</span>
        <span>场景渲染事件</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#相机控制">
        <span class="has-mr-6">3</span>
        <span>相机控制</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Viewer-类">
        <span class="has-mr-6">3.1</span>
        <span>Viewer 类</span>
        </a></li><li>
        <a class="is-flex" href="#Camera类">
        <span class="has-mr-6">3.2</span>
        <span>Camera类</span>
        </a></li><li>
        <a class="is-flex" href="#相机参数">
        <span class="has-mr-6">3.3</span>
        <span>相机参数</span>
        </a></li><li>
        <a class="is-flex" href="#示例">
        <span class="has-mr-6">3.4</span>
        <span>示例</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#量测工具">
        <span class="has-mr-6">4</span>
        <span>量测工具</span>
        </a></li><li>
        <a class="is-flex" href="#调试面板">
        <span class="has-mr-6">5</span>
        <span>调试面板</span>
        </a></li><li>
        <a class="is-flex" href="#与第三方库的集成">
        <span class="has-mr-6">6</span>
        <span>与第三方库的集成</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#集成-Three-js">
        <span class="has-mr-6">6.1</span>
        <span>集成 Three.js</span>
        </a></li><li>
        <a class="is-flex" href="#集成-Echarts">
        <span class="has-mr-6">6.2</span>
        <span>集成 Echarts</span>
        </a></li><li>
        <a class="is-flex" href="#集成-Heatmap">
        <span class="has-mr-6">6.3</span>
        <span>集成 Heatmap</span>
        </a></li><li>
        <a class="is-flex" href="#集成-Turf">
        <span class="has-mr-6">6.4</span>
        <span>集成 Turf</span>
        </a></li></ul></li></ul>
        </div>
    </div>
</div>

    
        


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Angular/">
            <span class="level-start">
                <span class="level-item">Angular</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">15</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/CSS/">
            <span class="level-start">
                <span class="level-item">CSS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Essay/">
            <span class="level-start">
                <span class="level-item">Essay</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">29</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIS/">
            <span class="level-start">
                <span class="level-item">GIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/HTTP/">
            <span class="level-start">
                <span class="level-item">HTTP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JavaScript/">
            <span class="level-start">
                <span class="level-item">JavaScript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">45</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Node-js/">
            <span class="level-start">
                <span class="level-item">Node.js</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/React/">
            <span class="level-start">
                <span class="level-item">React</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Vue/">
            <span class="level-start">
                <span class="level-item">Vue</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/CSS/" style="font-size: 13.33px;">CSS</a> <a href="/tags/Essay/" style="font-size: 18.33px;">Essay</a> <a href="/tags/GIS/" style="font-size: 11.67px;">GIS</a> <a href="/tags/HTTP/" style="font-size: 11.67px;">HTTP</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Node-js/" style="font-size: 13.33px;">Node.js</a> <a href="/tags/React/" style="font-size: 16.67px;">React</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a>
    </div>
</div>

    
    
        <div class="column-right-shadow  ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            <a href="/tips" class="tips">
                最新文章
            </a>
        </h3>
        
        <article class="media">
            
            <a href="/2021/08/22/GIS/11/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/11.webp" alt="Cesium 中一些常用方法汇总">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-08-21T16:00:00.000Z">2021-08-22</time></div>
                    <a href="/2021/08/22/GIS/11/" class="has-link-black-ter is-size-6">Cesium 中一些常用方法汇总</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/08/08/GIS/10/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/10.webp" alt="Cesium 中的事件与量测工具">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-08-07T16:00:00.000Z">2021-08-08</time></div>
                    <a href="/2021/08/08/GIS/10/" class="has-link-black-ter is-size-6">Cesium 中的事件与量测工具</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/08/07/GIS/09/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/09.webp" alt="glTF 与 3D Tiles">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-08-06T16:00:00.000Z">2021-08-07</time></div>
                    <a href="/2021/08/07/GIS/09/" class="has-link-black-ter is-size-6">glTF 与 3D Tiles</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/08/01/GIS/08/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/08.webp" alt="空间数据可视化">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-07-31T16:00:00.000Z">2021-08-01</time></div>
                    <a href="/2021/08/01/GIS/08/" class="has-link-black-ter is-size-6">空间数据可视化</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/07/30/GIS/07/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/07.webp" alt="坐标系及坐标变换">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-07-29T16:00:00.000Z">2021-07-30</time></div>
                    <a href="/2021/07/30/GIS/07/" class="has-link-black-ter is-size-6">坐标系及坐标变换</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIS/">GIS</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/08/">
                <span class="level-start">
                    <span class="level-item">八月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/07/">
                <span class="level-start">
                    <span class="level-item">七月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/06/">
                <span class="level-start">
                    <span class="level-item">六月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/04/">
                <span class="level-start">
                    <span class="level-item">四月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">三月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">一月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/10/">
                <span class="level-start">
                    <span class="level-item">十月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">九月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">八月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">七月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">六月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">五月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Angular/">
                        <span class="tag">Angular</span>
                        <span class="tag is-grey">15</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS/">
                        <span class="tag">CSS</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Essay/">
                        <span class="tag">Essay</span>
                        <span class="tag is-grey">29</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GIS/">
                        <span class="tag">GIS</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HTTP/">
                        <span class="tag">HTTP</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JavaScript/">
                        <span class="tag">JavaScript</span>
                        <span class="tag is-grey">45</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Node-js/">
                        <span class="tag">Node.js</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/React/">
                        <span class="tag">React</span>
                        <span class="tag is-grey">20</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Vue/">
                        <span class="tag">Vue</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <!-- <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Cesium 中的事件与量测工具" height="28">
                
                </a> -->
                <p class="is-size-7">
                &copy; 2016 - 2021
                Made with ✿  heptaluan&nbsp;
                
                </p>
            </div>
            <!-- <div class="level-end">
            
            </div> -->
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fa fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>