<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>关于 Hook 的一些总结 - heptaluan&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="因为手头上了项目暂时告一段落，也终于有时间可以回过头来总结总结，因为在之前关于 React 的使用也仅仅只局限在小型应用当中，而目前完结的这个项目算是整体基于 React 全家桶搭建而成的项目 当然在开发当中也遇到了不少棘手的问题，也踩了不少的坑，尤其是关于 Hook 的一些使用方面，所以也就打算抽些时间，重新温故一下文档以及参考一些前辈们整理的文章，简单的梳理一下在使用 Hook 过程当中遇到的">
<meta name="keywords" content="React">
<meta property="og:type" content="article">
<meta property="og:title" content="关于 Hook 的一些总结">
<meta property="og:url" content="http://yoursite.com/2021/04/18/React/21/index.html">
<meta property="og:site_name" content="heptaluan&#39;s blog">
<meta property="og:description" content="因为手头上了项目暂时告一段落，也终于有时间可以回过头来总结总结，因为在之前关于 React 的使用也仅仅只局限在小型应用当中，而目前完结的这个项目算是整体基于 React 全家桶搭建而成的项目 当然在开发当中也遇到了不少棘手的问题，也踩了不少的坑，尤其是关于 Hook 的一些使用方面，所以也就打算抽些时间，重新温故一下文档以及参考一些前辈们整理的文章，简单的梳理一下在使用 Hook 过程当中遇到的">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/21.webp">
<meta property="og:updated_time" content="2021-04-20T03:34:56.965Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于 Hook 的一些总结">
<meta name="twitter:description" content="因为手头上了项目暂时告一段落，也终于有时间可以回过头来总结总结，因为在之前关于 React 的使用也仅仅只局限在小型应用当中，而目前完结的这个项目算是整体基于 React 全家桶搭建而成的项目 当然在开发当中也遇到了不少棘手的问题，也踩了不少的坑，尤其是关于 Hook 的一些使用方面，所以也就打算抽些时间，重新温故一下文档以及参考一些前辈们整理的文章，简单的梳理一下在使用 Hook 过程当中遇到的">
<meta name="twitter:image" content="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/21.webp">







<link rel="icon" href="https://gitee.com/heptaluan/backups/raw/master/cdn/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.5.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <!-- fork me on github -->
<a title="Fork me on GitHub" id="forkMe" style="position: fixed;top: 0;right: 0;z-index: 31" href="https://github.com/heptaluan" target="_blank">
    <svg style="color: #fff;fill: #a0a1a7;height: 80px;width: 80px;" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg>
</a>

<nav class="navbar navbar-main">
    <div class="container">
        <!-- <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="关于 Hook 的一些总结" height="28">
            
            </a>
        </div> -->

        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="https://heptaluan.github.io/demos/">Demos</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fa fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/21.webp" alt="关于 Hook 的一些总结">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <div class="level-item has-text-grey">2021-04-18</div>
                <!-- <time class="level-item has-text-grey" datetime="2021-04-17T16:00:00.000Z">2021-04-18</time> -->
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/React/">React</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    37 分钟 读完 (大约 5509 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                关于 Hook 的一些总结
            
        </h1>
        <div class="content">
            <p>因为手头上了项目暂时告一段落，也终于有时间可以回过头来总结总结，因为在之前关于 <code>React</code> 的使用也仅仅只局限在小型应用当中，而目前完结的这个项目算是整体基于 <code>React</code> 全家桶搭建而成的项目</p>
<p>当然在开发当中也遇到了不少棘手的问题，也踩了不少的坑，尤其是关于 <code>Hook</code> 的一些使用方面，所以也就打算抽些时间，重新温故一下文档以及参考一些前辈们整理的文章，简单的梳理一下在使用 <code>Hook</code> 过程当中遇到的一些问题和总结</p>
<a id="more"></a>


<h2 id="单个-state-与多个-state"><a href="#单个-state-与多个-state" class="headerlink" title="单个 state 与多个 state"></a>单个 state 与多个 state</h2><p><code>useState</code> 的出现，让我们可以使用多个 <code>state</code> 变量来保存 <code>state</code>，比如</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> [width, setWidth] = useState(<span class="hljs-number">100</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> [height, setHeight] = useState(<span class="hljs-number">100</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> [left, setLeft] = useState(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> [top, setTop] = useState(<span class="hljs-number">0</span>)</span><br></pre></td></tr></table></figure>

<p>但同时我们也可以像 <code>Class</code> 组件的 <code>this.state</code> 一样，将所有的 <code>state</code> 放到一个对象中，这样我们就只需一个 <code>state</code> 变量即可</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> [state, setState] = useState(&#123;</span><br><span class="line">  width: <span class="hljs-number">100</span>,</span><br><span class="line">  height: <span class="hljs-number">100</span>,</span><br><span class="line">  left: <span class="hljs-number">0</span>,</span><br><span class="line">  top: <span class="hljs-number">0</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>那么问题来了，我们到底应该使用单个的 <code>state</code> 变量还是多个的 <code>state</code> 变量呢？</p>
<p>如果使用单个 <code>state</code> 变量，每次更新 <code>state</code> 时需要合并之前的 <code>state</code>，因为 <code>useState</code> 返回的 <code>setState</code> 会替换原来的值，这一点和 <code>Class</code> 组件的 <code>this.setState</code> 有所不同，<code>this.setState</code> 会把更新的字段自动合并到 <code>this.state</code> 对象中</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> handleMouseMove = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;</span><br><span class="line">  setState(<span class="hljs-function"><span class="hljs-params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">    ...prevState,</span><br><span class="line">    left: e.pageX,</span><br><span class="line">    top: e.pageY,</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果使用多个 <code>state</code> 变量可以让 <code>state</code> 的粒度更细，更易于逻辑的拆分和组合，比如们可以将关联的逻辑提取到自定义 <code>Hook</code> 中</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> usePosition = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [left, setLeft] = useState(<span class="hljs-number">0</span>)</span><br><span class="line">  <span class="hljs-keyword">const</span> [top, setTop] = useState(<span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [left, top, setLeft, setTop]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样一来，我们每次在更新 <code>left</code> 的时候 <code>top</code> 也会随之更新，因此把 <code>top</code> 和 <code>left</code> 拆分为两个 <code>state</code> 变量显得有点多余</p>
<p>在使用 <code>state</code> 之前，我们通常需要考虑状态拆分的『粒度』问题，如果粒度过细，代码就会变得比较冗余，如果粒度过粗，代码的可复用性就会降低，那么到底哪些 <code>state</code> 应该合并，哪些 <code>state</code> 又应该拆分呢？</p>
<p>简单来说我们遵循的规律主要有以下两点</p>
<ul>
<li>将完全不相关的 <code>state</code> 拆分为多组 <code>state</code>，比如 <code>size</code> 和 <code>position</code></li>
<li>如果某些 <code>state</code> 是相互关联的，或者需要一起发生改变，就可以把它们合并为一组 <code>state</code>，比如 <code>left</code> 和 <code>top</code></li>
</ul>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Box = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [position, setPosition] = usePosition()</span><br><span class="line">  <span class="hljs-keyword">const</span> [size, setSize] = useState(&#123; <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> &#125;)</span><br><span class="line">  <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> usePosition = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [position, setPosition] = useState(&#123; <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> &#125;)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [position, setPosition]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="依赖过多的问题"><a href="#依赖过多的问题" class="headerlink" title="依赖过多的问题"></a>依赖过多的问题</h2><p>我们在使用 <code>useEffect Hook</code> 时，为了避免每次 <code>render</code> 都去执行它的 <code>callback</code>，通常会传入第二个参数 <code>dependency array</code>，也就是我们常说的『依赖数组』，这样一来只有当依赖数组发生变化时，才会执行 <code>useEffect</code> 的回调函数</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; id, name &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(id, name)</span><br><span class="line">  &#125;, [id, name])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，只有当 <code>id</code> 或 <code>name</code> 发生变化时，才会打印日志，依赖数组中必须包含在 <code>callback</code> 内部用到的所有参与 <code>React</code> 数据流的值，比如 <code>state</code>、<code>props</code> 以及它们的衍生物，如果有遗漏，可能会埋下隐患</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; id, name &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// 由于依赖数组中不包含 name，所以当 name 发生变化时，无法打印日志</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(id, name)</span><br><span class="line">  &#125;, [id])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>React</code> 中，除了 <code>useEffect</code> 外，接收依赖数组作为参数的 <code>Hook</code> 还有 <code>useMemo</code>、<code>useCallback</code> 和 <code>useImperativeHandle</code>，我们在上面也提到过，依赖数组中千万不要遗漏回调函数内部依赖的值，但是如果依赖数组依赖了过多东西，可能导致代码难以维护，比如下面这段代码</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> refresh = useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;, [name, searchState, address, status, personA, personB, progress, page, size])</span><br></pre></td></tr></table></figure>

<p>光是看到这一堆依赖就令人头大，如果项目中到处都是这样的代码，可想而知维护起来多么痛苦，所以针对于这样的情况，我们就需要重新的思考一下这些 <code>deps</code> 是否真的都需要？看下面这个例子</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; id &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> requestParams = useRef(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    requestParams.current = &#123; <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">size</span>: <span class="hljs-number">20</span>, id &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> refresh = useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    doRefresh(requestParams.current)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    id &amp;&amp; refresh()</span><br><span class="line">  &#125;, [id, refresh])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然 <code>useEffect</code> 的回调函数依赖了 <code>id</code> 和 <code>refresh</code> 方法，但是我们观察 <code>refresh</code> 方法可以发现，它在首次 <code>render</code> 被创建之后，就永远不会发生改变了，因此把它作为 <code>useEffect</code> 的 <code>deps</code> 是多余的</p>
<p>其次，如果这些依赖真的都是需要的，那么这些逻辑是否应该放到同一个 <code>Hook</code> 中</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; id, name, address, status, personA, personB, progress &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [page, setPage] = useState()</span><br><span class="line">  <span class="hljs-keyword">const</span> [size, setSize] = useState()</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> doSearch = useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> doRefresh = useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    id &amp;&amp; doSearch(&#123; name, address, status, personA, personB, progress &#125;)</span><br><span class="line">    page &amp;&amp; doRefresh(&#123; name, page, size &#125;)</span><br><span class="line">  &#125;, [id, name, address, status, personA, personB, progress, page, size])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出，在 <code>useEffect</code> 中有两段逻辑，而且这两段逻辑是相互独立的，因此我们可以将这两段逻辑放到不同 <code>useEffect</code> 中</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  id &amp;&amp; doSearch(&#123; name, address, status, personA, personB, progress &#125;)</span><br><span class="line">&#125;, [id, name, address, status, personA, personB, progress])</span><br><span class="line"></span><br><span class="line">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  page &amp;&amp; doRefresh(&#123; name, page, size &#125;)</span><br><span class="line">&#125;, [name, page, size])</span><br></pre></td></tr></table></figure>

<p>但是如果逻辑无法继续拆分，但是依赖数组还是依赖了过多东西，该怎么办呢？就比如我们上面的代码</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  id &amp;&amp; doSearch(&#123; name, address, status, personA, personB, progress &#125;)</span><br><span class="line">&#125;, [id, name, address, status, personA, personB, progress])</span><br></pre></td></tr></table></figure>

<p>这段代码中的 <code>useEffect</code> 依赖了七个值，但是我们仔细观察上面的代码，可以发现这些值都是『过滤条件』的一部分，通过这些条件可以过滤页面上的数据，因此我们可以将它们看做一个整体，也就是我们前面讲过的合并 <code>state</code></p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> [filters, setFilters] = useState(&#123;</span><br><span class="line">  name: <span class="hljs-string">''</span>,</span><br><span class="line">  address: <span class="hljs-string">''</span>,</span><br><span class="line">  status: <span class="hljs-string">''</span>,</span><br><span class="line">  personA: <span class="hljs-string">''</span>,</span><br><span class="line">  personB: <span class="hljs-string">''</span>,</span><br><span class="line">  progress: <span class="hljs-string">''</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  id &amp;&amp; doSearch(filters)</span><br><span class="line">&#125;, [id, filters])</span><br></pre></td></tr></table></figure>

<p>但是如果 <code>state</code> 不能合并，并且在 <code>callback</code> 内部又使用了 <code>setState</code> 方法的话，在这种情况下，我们就可以考虑使用 <code>setState callback</code> 来减少一些依赖，比如</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> useValues = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    count: <span class="hljs-number">0</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [updateData] = useCallback(</span><br><span class="line">    nextData =&gt; &#123;</span><br><span class="line">      setValues(&#123;</span><br><span class="line">        data: nextData,</span><br><span class="line">        <span class="hljs-comment">// 因为 callback 内部依赖了外部的 values 变量，所以必须在依赖数组中指定它</span></span><br><span class="line">        count: values.count + <span class="hljs-number">1</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    [values]</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [values, updateData]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码中，我们必须在 <code>useCallback</code> 的依赖数组中指定 <code>values</code>，否则我们无法在 <code>callback</code> 中获取到最新的 <code>values</code> 状态，但是通过 <code>setState</code> 回调函数，我们就不用再依赖外部的 <code>values</code> 变量，因此也无需在依赖数组中指定它，就像下面这样</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> useValues = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [values, setValues] = useState(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [updateData] = useCallback(<span class="hljs-function"><span class="hljs-params">nextData</span> =&gt;</span> &#123;</span><br><span class="line">    setValues(<span class="hljs-function"><span class="hljs-params">prevValues</span> =&gt;</span> (&#123;</span><br><span class="line">      data: nextData,</span><br><span class="line">      <span class="hljs-comment">// 通过 setState 回调函数获取最新的 values 状态，这时 callback 不再依赖于外部的 values 变量了</span></span><br><span class="line">      <span class="hljs-comment">// 因此依赖数组中不需要指定任何值</span></span><br><span class="line">      count: prevValues.count + <span class="hljs-number">1</span>,</span><br><span class="line">    &#125;))</span><br><span class="line">  <span class="hljs-comment">// 这个 callback 永远不会重新创建</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [values, updateData]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们还可以通过 <code>ref</code> 来保存可变变量，以前我们只是把 <code>ref</code> 用作保持 <code>DOM</code> 节点引用的工具，可是 <code>useRef Hook</code> 能做的事情远不止如此，我们可以用它来保存一些值的引用，并对它进行读写，举个例子</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> useValues = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [values, setValues] = useState(&#123;&#125;)</span><br><span class="line">  <span class="hljs-keyword">const</span> latestValues = useRef(values)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    latestValues.current = values</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [updateData] = useCallback(<span class="hljs-function"><span class="hljs-params">nextData</span> =&gt;</span> &#123;</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      data: nextData,</span><br><span class="line">      count: latestValues.current.count + <span class="hljs-number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [values, updateData]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是需要注意的是，我们在使用 <code>ref</code> 的过程当中要特别小心，因为它可以随意赋值，所以一定要控制好修改它的方法，特别是一些底层模块，在封装的时候千万不要直接暴露 <code>ref</code>，而是提供一些修改它的方法</p>
<p>说了这么多，归根到底都是为了写出更加清晰、易于维护的代码，如果发现依赖数组依赖过多，我们就需要重新审视自己的代码</p>
<ul>
<li>依赖数组依赖的值最好不要超过三个，否则会导致代码会难以维护</li>
<li>如果发现依赖数组依赖的值过多，我们应该采取一些方法来减少它<ul>
<li>去掉不必要的依赖</li>
<li>将 <code>Hook</code> 拆分为更小的单元，每个 <code>Hook</code> 依赖于各自的依赖数组</li>
<li>通过合并相关的 <code>state</code>，将多个依赖值聚合为一个</li>
<li>通过 <code>setState</code> 回调函数获取最新的 <code>state</code>，以减少外部依赖</li>
<li>通过 <code>ref</code> 来读取可变变量的值，不过需要注意控制修改它的途径</li>
</ul>
</li>
</ul>
<h2 id="该不该使用-useMemo"><a href="#该不该使用-useMemo" class="headerlink" title="该不该使用 useMemo"></a>该不该使用 useMemo</h2><p>对于这个问题，有的人从来没有思考过，有的人甚至不觉得这是个问题，因为我们在网上经常见到的做法是，那就是不管什么情况，只要用 <code>useMemo</code> 或者 <code>useCallback</code> 简单的『包裹一下』，似乎就能使应用远离性能的问题，但真的是这样吗？有的时候 <code>useMemo</code> 没有任何作用，甚至还会影响应用的性能</p>
<p>为什么这么说呢？首先我们需要知道，<code>useMemo</code> 本身也有开销，<code>useMemo</code> 会『记住』一些值，同时在后续 <code>render</code> 时，将依赖数组中的值取出来和上一次记录的值进行比较，如果不相等才会重新执行回调函数，否则直接返回『记住』的值，这个过程本身就会消耗一定的内存和计算资源，因此过度使用 <code>useMemo</code> 可能会影响程序的性能</p>
<p>所以说要想合理使用 <code>useMemo</code>，我们需要搞清楚 <code>useMemo</code> 适用的场景</p>
<ul>
<li>有些计算开销很大，我们就需要『记住』它的返回值，避免每次 <code>render</code> 都去重新计算</li>
<li>由于值的引用发生变化，导致下游组件重新渲染，我们也需要『记住』这个值</li>
</ul>
<p>让我们来看个例子</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; page, type &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> resolvedValue = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> getResolvedValue(page, type)</span><br><span class="line">  &#125;, [page, type])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">resolvedValue</span>=<span class="hljs-string">&#123;resolvedValue&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="hljs-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，渲染 <code>ExpensiveComponent</code> 的开销很大，所以当 <code>resolvedValue</code> 的引用发生变化时，我们不想重新渲染这个组件，因此使用 <code>useMemo</code> 来避免每次 <code>render</code> 的时候重新计算 <code>resolvedValue</code>，导致它的引用发生改变，从而使下游组件 <code>re-render</code></p>
<p>这个担忧是正确的，但是使用 <code>useMemo</code> 之前，我们应该先思考两个问题</p>
<ol>
<li>传递给 <code>useMemo</code> 的函数开销大不大？</li>
</ol>
<p>在上面的例子中，就是考虑 <code>getResolvedValue</code> 函数的开销大不大，<code>JavaScript</code> 中大多数方法都是优化过的，比如 <code>Array.map</code>、<code>Array.forEach</code> 等，如果你执行的操作开销不大，那么就不需要记住返回值，否则使用 <code>useMemo</code> 本身的开销就可能超过重新计算这个值的开销，因此对于一些简单的 <code>JavaScript</code> 运算来说，我们不需要使用 <code>useMemo</code> 来记住它的返回值</p>
<ol start="2">
<li>当输入相同时，记忆的值的引用是否会发生改变？</li>
</ol>
<p>在上面的例子中，就是当 <code>page</code> 和 <code>type</code> 相同时，<code>resolvedValue</code> 的引用是否会发生改变？这里我们就需要考虑 <code>resolvedValue</code> 的类型了，如果 <code>resolvedValue</code> 是一个对象，由于我们项目上使用『函数式编程』，每次函数调用都会产生一个新的引用，但是如果 <code>resolvedValue</code> 是一个原始值（<code>string</code>，<code>boolean</code>，<code>null</code>，<code>undefined</code>，<code>number</code>，<code>symbol</code>），也就不存在『引用』的概念了，每次计算出来的这个值一定是相等的，也就是说 <code>ExpensiveComponent</code> 组件不会被重新渲染</p>
<p>因此，如果 <code>getResolvedValue</code> 的开销不大，并且 <code>resolvedValue</code> 返回一个字符串之类的原始值，那我们完全可以去掉 <code>useMemo</code>，就像下面这样</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">&#123; page, type &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> resolvedValue = getResolvedValue(page, type)</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">resolvedValue</span>=<span class="hljs-string">&#123;resolvedValue&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="hljs-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>还有一个误区就是对创建函数开销的评估，有的人觉得在 <code>render</code> 中创建函数可能会开销比较大，为了避免函数多次创建，使用了 <code>useMemo</code> 或者 <code>useCallback</code>，但是对于现代浏览器来说，创建函数的成本微乎其微</p>
<p>因此我们没有必要使用 <code>useMemo</code> 或者 <code>useCallback</code> 去节省这部分性能开销，当然如果是为了保证每次 <code>render</code> 时回调的引用相等，你可以放心使用 <code>useMemo</code> 或者 <code>useCallback</code></p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-comment">// 考虑这里的 useCallback 是否必要</span></span><br><span class="line">  <span class="hljs-keyword">const</span> onSubmit = useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    doSomething()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;onSubmit&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实通常来说在这里可能会存在一些争议，那就是如果只是想在重新渲染时保持值的引用不变，除了可以使用 <code>useMemo</code> 外，还可以使用 <code>useRef</code>，那么它们两者之间有什么区别呢？</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 使用 useMemo</span></span><br><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> users = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [])</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">users</span>=<span class="hljs-string">&#123;users&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="hljs-xml">&#125;</span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml">// 使用 useRef</span></span><br><span class="line"><span class="hljs-xml">const Example = () =&gt; &#123;</span></span><br><span class="line"><span class="hljs-xml">  const &#123; current: users &#125; = useRef([1, 2, 3])</span></span><br><span class="line">  return &lt;ExpensiveComponent users=&#123;users&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，我们用 <code>useMemo</code> 来『记住』<code>users</code> 数组，不是因为数组本身的开销大，而是因为 <code>users</code> 的引用在每次 <code>render</code> 时都会发生改变，从而导致子组件 <code>ExpensiveComponent</code> 重新渲染（可能会带来较大开销）</p>
<p>虽然在 <code>React</code> 中 <code>useRef</code> 和 <code>useMemo</code> 的实现有一点差别，但是当 <code>useMemo</code> 的依赖数组为空数组时，它和 <code>useRef</code> 的开销可以说相差无几，<code>useRef</code> 甚至可以直接用 <code>useMemo</code> 来实现，就像下面这样</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> useRef = <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> (&#123; <span class="hljs-attr">current</span>: v &#125;), [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，使用 <code>useMemo</code> 或者是 <code>useRef</code> 都可以用来保持值的引用一致</p>
<p>我们在编写自定义 <code>Hook</code> 时，返回值一定要保持引用的一致性，因为你无法确定外部要如何使用它的返回值，如果返回值被用做其他 <code>Hook</code> 的依赖，并且每次 <code>re-render</code> 时引用不一致（当值相等的情况），就可能就会产生问题，比如</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> useData = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-comment">// 获取异步数据</span></span><br><span class="line">  <span class="hljs-keyword">const</span> resp = getAsyncData([])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// 处理获取到的异步数据，这里使用了 Array.map</span></span><br><span class="line">  <span class="hljs-comment">// 因此即使 data 相同，每次调用得到的引用也是不同的</span></span><br><span class="line">  <span class="hljs-keyword">const</span> mapper = <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> data.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (&#123; ...item, <span class="hljs-attr">selected</span>: <span class="hljs-literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> resp ? mapper(resp) : resp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> Example = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> data = useData()</span><br><span class="line">  <span class="hljs-keyword">const</span> [dataChanged, setDataChanged] = useState(<span class="hljs-literal">false</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// 当 data 发生变化时，调用 setState</span></span><br><span class="line">    <span class="hljs-comment">// 如果 data 值相同而引用不同，就可能会产生非预期的结果</span></span><br><span class="line">    setDataChanged(<span class="hljs-function"><span class="hljs-params">prevDataChanged</span> =&gt;</span> !prevDataChanged)</span><br><span class="line">  &#125;, [data])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-built_in">console</span>.log(dataChanged)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="hljs-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，我们通过 <code>useData Hook</code> 获取了 <code>data</code>，每次 <code>render</code> 时 <code>data</code> 的值没有发生变化，但是引用却不一致，如果把 <code>data</code> 用到 <code>useEffect</code> 的依赖数组中，就可能产生非预期的结果，另外由于引用的不同，也会导致 <code>ExpensiveComponent</code> 组件 <code>re-render</code>，产生性能问题</p>
<blockquote>
<p>如果因为 <code>prop</code> 的值相同而引用不同，从而导致子组件发生 <code>re-render</code>，不一定会造成性能问题，因为 <code>Virtual DOM re-render</code> 并不等同于 <code>DOM re-render</code>，但是当子组件特别大时，<code>Virtual DOM</code> 的 <code>Diff</code> 开销也很大，因此还是应该尽量避免子组件 <code>re-render</code></p>
</blockquote>
<p>所以在使用 <code>useMemo</code> 之前，我们不妨先问自己几个问题</p>
<ul>
<li>要记住的函数开销很大吗？</li>
<li>返回的值是原始值吗？</li>
<li>记忆的值会被其他 <code>Hook</code> 或者子组件用到吗？</li>
</ul>
<p>下面我们就来看看 <code>useMemo</code> 的具体使用场景</p>
<h4 id="应该使用-useMemo-的场景"><a href="#应该使用-useMemo-的场景" class="headerlink" title="应该使用 useMemo 的场景"></a>应该使用 useMemo 的场景</h4><ol>
<li>保持引用相等<ul>
<li>对于组件内部用到的 <code>object</code>、<code>array</code>、函数等，如果用在了其他 <code>Hook</code> 的依赖数组中，或者作为 <code>props</code> 传递给了下游组件，应该使用 <code>useMemo</code></li>
<li>自定义 <code>Hook</code> 中暴露出来的 <code>object</code>、<code>array</code>、函数等，都应该使用 <code>useMemo</code>，以确保当值相同时，引用不发生变化</li>
<li>使用 <code>Context</code> 时，如果 <code>Provider</code> 的 <code>value</code> 中定义的值（第一层）发生了变化，即便用了 <code>Pure Component</code> 或者 <code>React.memo</code>，仍然会导致子组件 <code>re-render</code>，这种情况下，仍然建议使用 <code>useMemo</code> 保持引用的一致性</li>
</ul>
</li>
<li>成本很高的计算<ul>
<li>比如 <code>cloneDeep</code> 一个很大并且层级很深的数据</li>
</ul>
</li>
</ol>
<h4 id="无需使用-useMemo-的场景"><a href="#无需使用-useMemo-的场景" class="headerlink" title="无需使用 useMemo 的场景"></a>无需使用 useMemo 的场景</h4><ol>
<li>如果返回的值是原始值 <code>string</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>、<code>number</code>、<code>symbol</code>（不包括动态声明的 <code>Symbol</code>），一般不需要使用 <code>useMemo</code></li>
<li>仅在组件内部用到的 <code>object</code>、<code>array</code>、函数等（没有作为 <code>props</code> 传递给子组件），且没有用到其他 <code>Hook</code> 的依赖数组中，一般不需要使用 <code>useMemo</code></li>
</ol>
<h2 id="一些好的实践方式"><a href="#一些好的实践方式" class="headerlink" title="一些好的实践方式"></a>一些好的实践方式</h2><ol>
<li>若 <code>Hook</code> 类型相同，且依赖数组一致时，应该合并成一个 <code>Hook</code>，否则会产生更多开销</li>
</ol>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> dataA = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> getDataA()</span><br><span class="line">&#125;, [A, B])</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> dataB = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> getDataB()</span><br><span class="line">&#125;, [A, B])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 应该合并为 ==&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> [dataA, dataB] = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> [getDataA(), getDataB()]</span><br><span class="line">&#125;, [A, B])</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>参考原生 <code>Hooks</code> 的设计，自定义 <code>Hooks</code> 的返回值可以使用 <code>Tuple</code> 类型，更易于在外部重命名，但如果返回值的数量超过三个，还是建议返回一个对象</li>
</ol>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useToggle = <span class="hljs-function">(<span class="hljs-params">defaultVisible: boolean = <span class="hljs-literal">false</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [visible, setVisible] = useState(defaultVisible)</span><br><span class="line">  <span class="hljs-keyword">const</span> show = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> setVisible(<span class="hljs-literal">true</span>)</span><br><span class="line">  <span class="hljs-keyword">const</span> hide = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> setVisible(<span class="hljs-literal">false</span>)</span><br><span class="line">  <span class="hljs-keyword">return</span> [visible, show, hide] <span class="hljs-keyword">as</span> [<span class="hljs-keyword">typeof</span> visible, <span class="hljs-keyword">typeof</span> show, <span class="hljs-keyword">typeof</span> hide]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 在外部可以更方便地修改名字</span></span><br><span class="line"><span class="hljs-keyword">const</span> [isOpen, open, close] = useToggle()</span><br><span class="line"><span class="hljs-keyword">const</span> [visible, show, hide] = useToggle()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><code>ref</code> 不要直接暴露给外部使用，而是提供一个修改值的方法</p>
</li>
<li><p>在使用 <code>useMemo</code> 或者 <code>useCallback</code> 时，确保返回的函数只创建一次，也就是说，函数不会根据依赖数组的变化而二次创建，举个例子</p>
</li>
</ol>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCount = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [increase, decrease] = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> increase = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(count + <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">const</span> decrease = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(count - <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> [increase, decrease]</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [count, increase, decrease]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>useCount Hook</code> 中，<code>count</code> 状态的改变会让 <code>useMemo</code> 中的 <code>increase</code> 和 <code>decrease</code> 函数被重新创建，由于闭包特性，如果这两个函数被其他 <code>Hook</code> 用到了，我们应该将这两个函数也添加到相应 <code>Hook</code> 的依赖数组中，否则就会产生问题，比如</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Counter = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [count, increase] = useCount()</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="hljs-comment">// 执行后 count 的值永远都是 1</span></span><br><span class="line">      increase()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">'click'</span>, handleClick)</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="hljs-built_in">document</span>.body.removeEventListener(<span class="hljs-string">'click'</span>, handleClick)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>useCount</code> 中，<code>increase</code> 会随着 <code>count</code> 的变化而被重新创建，但是 <code>increase</code> 被重新创建之后，<code>useEffect</code> 并不会再次执行，所以 <code>useEffect</code> 中取到的 <code>increase</code> 永远都是首次创建时的 <code>increase</code>，而首次创建时 <code>count</code> 的值为 <code>0</code>，因此无论点击多少次，<code>count</code> 的值永远都是 <code>1</code></p>
<p>既然这样的话，那把 <code>increase</code> 函数放到 <code>useEffect</code> 的依赖数组中不就好了吗？事实上，这会带来更多问题</p>
<ul>
<li>首先 <code>increase</code> 的变化会导致频繁地绑定事件监听，以及解除事件监听</li>
<li>其次需求是只在组件 <code>mount</code> 时执行一次 <code>useEffect</code>，但是 <code>increase</code> 的变化会导致 <code>useEffect</code> 多次执行，不能满足需求</li>
</ul>
<p>那么我们如何解决这些问题呢？有下面两种方式</p>
<ol>
<li>通过 <code>setState</code> 回调，让函数不依赖外部变量，例如</li>
</ol>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCount = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [increase, decrease] = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> increase = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="hljs-function"><span class="hljs-params">latestCount</span> =&gt;</span> latestCount + <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> decrease = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="hljs-function"><span class="hljs-params">latestCount</span> =&gt;</span> latestCount - <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> [increase, decrease]</span><br><span class="line">  <span class="hljs-comment">// 保持依赖数组为空，这样 increase 和 decrease 方法都只会被创建一次</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [count, increase, decrease]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过 <code>ref</code> 来保存可变变量，例如</li>
</ol>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCount = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">0</span>)</span><br><span class="line">  <span class="hljs-keyword">const</span> countRef = useRef(count)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    countRef.current = count</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> [increase, decrease] = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> increase = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(countRef.current + <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> decrease = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(countRef.current - <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> [increase, decrease]</span><br><span class="line">  <span class="hljs-comment">// 保持依赖数组为空，这样 increase 和 decrease 方法都只会被创建一次</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [count, increase, decrease]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后的最后，我们再来将上面涉及到的内容整体的回顾一下</p>
<ul>
<li>将完全不相关的 <code>state</code> 拆分为多组 <code>state</code></li>
<li>如果某些 <code>state</code> 是相互关联的，或者需要一起发生改变，就可以把它们合并为一组 <code>state</code></li>
<li>依赖数组的值最好不要过多，如果发现依赖数组依赖的值过多，我们应该采取一些方法来减少它<ul>
<li>去掉不必要的依赖</li>
<li>将 <code>Hook</code> 拆分为更小的单元，每个 <code>Hook</code> 依赖于各自的依赖数组</li>
<li>通过合并相关的 <code>state</code>，将多个依赖值聚合为一个</li>
<li>通过 <code>setState</code> 回调函数获取最新的 <code>state</code>，以减少外部依赖</li>
<li>通过 <code>ref</code> 来读取可变变量的值，不过需要注意控制修改它的途径</li>
</ul>
</li>
<li>应该使用 <code>useMemo</code> 的场景<ul>
<li>保持引用相等</li>
<li>成本很高的计算</li>
</ul>
</li>
<li>无需使用 <code>useMemo</code> 的场景<ul>
<li>如果返回的值是原始值，一般不需要使用 <code>useMemo</code></li>
<li>仅在组件内部用到的 <code>object</code>、<code>array</code>、函数等（没有作为 <code>props</code> 传递给子组件），且没有用到其他 <code>Hook</code> 的依赖数组中，一般不需要使用 <code>useMemo</code></li>
</ul>
</li>
<li>若 <code>Hook</code> 类型相同，且依赖数组一致时，应该合并成一个 <code>Hook</code></li>
<li>自定义 <code>Hook</code> 的返回值可以使用 <code>Tuple</code> 类型，更易于在外部重命名，如果返回的值过多，则不建议使用</li>
<li><code>ref</code> 不要直接暴露给外部使用，而是提供一个修改值的方法</li>
<li>在使用 <code>useMemo</code> 或者 <code>useCallback</code> 时，可以借助 <code>ref</code> 或者 <code>setState callback</code>，确保返回的函数只创建一次，也就是说，函数不会根据依赖数组的变化而二次创建</li>
</ul>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/React/">React</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2021/03/28/React/20/">
                <span class="level-item">自定义 Hook</span>
                <i class="level-item fa fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: '584b59de0d23cd48fbdd',
        clientSecret: '5554c9aab0a640015867806f438bd2e10f297e5a',
        id: 'f1ca36b59962110624cd0568a5184bd1',
        repo: 'gitalk',
        owner: 'heptaluan',
        admin: "heptaluan"
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <figure class="avatar image is-128x128 has-mb-6">
                            <img class="is-rounded" src="https://gitee.com/heptaluan/backups/raw/master/cdn/avatar.png" alt="heptaluan">
                        </figure>
                    
                    
                    <p class="is-size-4 is-block">
                        heptaluan
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Torches@Aimer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>WuHan China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <!-- <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        153
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        8
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        8
                    </p>
                </div>
            </div>
        </nav> -->
        <!-- <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                关注我</a>
        </div> -->
        
        
    </div>
</div>
    
        
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#单个-state-与多个-state">
        <span class="has-mr-6">1</span>
        <span>单个 state 与多个 state</span>
        </a></li><li>
        <a class="is-flex" href="#依赖过多的问题">
        <span class="has-mr-6">2</span>
        <span>依赖过多的问题</span>
        </a></li><li>
        <a class="is-flex" href="#该不该使用-useMemo">
        <span class="has-mr-6">3</span>
        <span>该不该使用 useMemo</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#应该使用-useMemo-的场景">
        <span class="has-mr-6">3.1</span>
        <span>应该使用 useMemo 的场景</span>
        </a></li><li>
        <a class="is-flex" href="#无需使用-useMemo-的场景">
        <span class="has-mr-6">3.2</span>
        <span>无需使用 useMemo 的场景</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#一些好的实践方式">
        <span class="has-mr-6">4</span>
        <span>一些好的实践方式</span>
        </a></li><li>
        <a class="is-flex" href="#总结">
        <span class="has-mr-6">5</span>
        <span>总结</span>
        </a></li></ul>
        </div>
    </div>
</div>

    
        


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Angular/">
            <span class="level-start">
                <span class="level-item">Angular</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">15</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/CSS/">
            <span class="level-start">
                <span class="level-item">CSS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Essay/">
            <span class="level-start">
                <span class="level-item">Essay</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">29</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/HTTP/">
            <span class="level-start">
                <span class="level-item">HTTP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JavaScript/">
            <span class="level-start">
                <span class="level-item">JavaScript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">45</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Node-js/">
            <span class="level-start">
                <span class="level-item">Node.js</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/React/">
            <span class="level-start">
                <span class="level-item">React</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Vue/">
            <span class="level-start">
                <span class="level-item">Vue</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/CSS/" style="font-size: 13.33px;">CSS</a> <a href="/tags/Essay/" style="font-size: 18.33px;">Essay</a> <a href="/tags/HTTP/" style="font-size: 11.67px;">HTTP</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Node-js/" style="font-size: 13.33px;">Node.js</a> <a href="/tags/React/" style="font-size: 16.67px;">React</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a>
    </div>
</div>

    
    
        <div class="column-right-shadow  ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            <a href="/tips" class="tips">
                最新文章
            </a>
        </h3>
        
        <article class="media">
            
            <a href="/2021/04/18/React/21/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/21.webp" alt="关于 Hook 的一些总结">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-04-17T16:00:00.000Z">2021-04-18</time></div>
                    <a href="/2021/04/18/React/21/" class="has-link-black-ter is-size-6">关于 Hook 的一些总结</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/React/">React</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/28/React/20/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/20.webp" alt="自定义 Hook">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-27T16:00:00.000Z">2021-03-28</time></div>
                    <a href="/2021/03/28/React/20/" class="has-link-black-ter is-size-6">自定义 Hook</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/React/">React</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/07/Vue/06/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/06.webp" alt="Vite 的工程化流程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-06T16:00:00.000Z">2021-03-07</time></div>
                    <a href="/2021/03/07/Vue/06/" class="has-link-black-ter is-size-6">Vite 的工程化流程</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Vue/">Vue</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/10/JavaScript/59/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/59.webp" alt="在 React 当中使用 TypeScript">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-09T16:00:00.000Z">2021-01-10</time></div>
                    <a href="/2021/01/10/JavaScript/59/" class="has-link-black-ter is-size-6">在 React 当中使用 TypeScript</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JavaScript/">JavaScript</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/09/JavaScript/58/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://gitee.com/heptaluan/backups/raw/master/cdn/cover/58.webp" alt="深入 TypeScript 当中的泛型">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-08T16:00:00.000Z">2021-01-09</time></div>
                    <a href="/2021/01/09/JavaScript/58/" class="has-link-black-ter is-size-6">深入 TypeScript 当中的泛型</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JavaScript/">JavaScript</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/04/">
                <span class="level-start">
                    <span class="level-item">四月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">三月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">一月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/10/">
                <span class="level-start">
                    <span class="level-item">十月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">九月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">八月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">七月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">六月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">五月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Angular/">
                        <span class="tag">Angular</span>
                        <span class="tag is-grey">15</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS/">
                        <span class="tag">CSS</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Essay/">
                        <span class="tag">Essay</span>
                        <span class="tag is-grey">29</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/HTTP/">
                        <span class="tag">HTTP</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JavaScript/">
                        <span class="tag">JavaScript</span>
                        <span class="tag is-grey">45</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Node-js/">
                        <span class="tag">Node.js</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/React/">
                        <span class="tag">React</span>
                        <span class="tag is-grey">20</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Vue/">
                        <span class="tag">Vue</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <!-- <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="关于 Hook 的一些总结" height="28">
                
                </a> -->
                <p class="is-size-7">
                &copy; 2016 - 2021
                Made with ✿  heptaluan&nbsp;
                
                </p>
            </div>
            <!-- <div class="level-end">
            
            </div> -->
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fa fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>